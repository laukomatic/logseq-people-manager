(function(){"use strict";var Pe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},De={exports:{}};/*! For license information please see lsplugin.user.js.LICENSE.txt */De.exports,function(c,m){(function(b,p){c.exports=p()})(self,()=>(()=>{var b={833:(I,h,x)=>{var O=x(606);h.formatArgs=function(M){if(M[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+M[0]+(this.useColors?"%c ":" ")+"+"+I.exports.humanize(this.diff),!this.useColors)return;const F="color: "+this.color;M.splice(1,0,F,"color: inherit");let g=0,l=0;M[0].replace(/%[a-zA-Z%]/g,E=>{E!=="%%"&&(g++,E==="%c"&&(l=g))}),M.splice(l,0,F)},h.save=function(M){try{M?h.storage.setItem("debug",M):h.storage.removeItem("debug")}catch{}},h.load=function(){let M;try{M=h.storage.getItem("debug")}catch{}return!M&&O!==void 0&&"env"in O&&(M=O.env.DEBUG),M},h.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},h.storage=function(){try{return localStorage}catch{}}(),h.destroy=(()=>{let M=!1;return()=>{M||(M=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),h.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],h.log=console.debug||console.log||(()=>{}),I.exports=x(736)(h);const{formatters:C}=I.exports;C.j=function(M){try{return JSON.stringify(M)}catch(F){return"[UnexpectedJSONParseError]: "+F.message}}},736:(I,h,x)=>{I.exports=function(O){function C(g){let l,E,y,S=null;function w(...U){if(!w.enabled)return;const q=w,D=Number(new Date),z=D-(l||D);q.diff=z,q.prev=l,q.curr=D,l=D,U[0]=C.coerce(U[0]),typeof U[0]!="string"&&U.unshift("%O");let a=0;U[0]=U[0].replace(/%([a-zA-Z%])/g,(d,_)=>{if(d==="%%")return"%";a++;const L=C.formatters[_];if(typeof L=="function"){const X=U[a];d=L.call(q,X),U.splice(a,1),a--}return d}),C.formatArgs.call(q,U),(q.log||C.log).apply(q,U)}return w.namespace=g,w.useColors=C.useColors(),w.color=C.selectColor(g),w.extend=M,w.destroy=C.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>S!==null?S:(E!==C.namespaces&&(E=C.namespaces,y=C.enabled(g)),y),set:U=>{S=U}}),typeof C.init=="function"&&C.init(w),w}function M(g,l){const E=C(this.namespace+(l===void 0?":":l)+g);return E.log=this.log,E}function F(g){return g.toString().substring(2,g.toString().length-2).replace(/\.\*\?$/,"*")}return C.debug=C,C.default=C,C.coerce=function(g){return g instanceof Error?g.stack||g.message:g},C.disable=function(){const g=[...C.names.map(F),...C.skips.map(F).map(l=>"-"+l)].join(",");return C.enable(""),g},C.enable=function(g){let l;C.save(g),C.namespaces=g,C.names=[],C.skips=[];const E=(typeof g=="string"?g:"").split(/[\s,]+/),y=E.length;for(l=0;l<y;l++)E[l]&&((g=E[l].replace(/\*/g,".*?"))[0]==="-"?C.skips.push(new RegExp("^"+g.slice(1)+"$")):C.names.push(new RegExp("^"+g+"$")))},C.enabled=function(g){if(g[g.length-1]==="*")return!0;let l,E;for(l=0,E=C.skips.length;l<E;l++)if(C.skips[l].test(g))return!1;for(l=0,E=C.names.length;l<E;l++)if(C.names[l].test(g))return!0;return!1},C.humanize=x(585),C.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(O).forEach(g=>{C[g]=O[g]}),C.names=[],C.skips=[],C.formatters={},C.selectColor=function(g){let l=0;for(let E=0;E<g.length;E++)l=(l<<5)-l+g.charCodeAt(E),l|=0;return C.colors[Math.abs(l)%C.colors.length]},C.enable(C.load()),C}},744:I=>{var h=function(y){return function(S){return!!S&&typeof S=="object"}(y)&&!function(S){var w=Object.prototype.toString.call(S);return w==="[object RegExp]"||w==="[object Date]"||function(U){return U.$$typeof===x}(S)}(y)},x=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.element"):60103;function O(y,S){return S.clone!==!1&&S.isMergeableObject(y)?l((w=y,Array.isArray(w)?[]:{}),y,S):y;var w}function C(y,S,w){return y.concat(S).map(function(U){return O(U,w)})}function M(y){return Object.keys(y).concat(function(S){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(S).filter(function(w){return Object.propertyIsEnumerable.call(S,w)}):[]}(y))}function F(y,S){try{return S in y}catch{return!1}}function g(y,S,w){var U={};return w.isMergeableObject(y)&&M(y).forEach(function(q){U[q]=O(y[q],w)}),M(S).forEach(function(q){(function(D,z){return F(D,z)&&!(Object.hasOwnProperty.call(D,z)&&Object.propertyIsEnumerable.call(D,z))})(y,q)||(F(y,q)&&w.isMergeableObject(S[q])?U[q]=function(D,z){if(!z.customMerge)return l;var a=z.customMerge(D);return typeof a=="function"?a:l}(q,w)(y[q],S[q],w):U[q]=O(S[q],w))}),U}function l(y,S,w){(w=w||{}).arrayMerge=w.arrayMerge||C,w.isMergeableObject=w.isMergeableObject||h,w.cloneUnlessOtherwiseSpecified=O;var U=Array.isArray(S);return U===Array.isArray(y)?U?w.arrayMerge(y,S,w):g(y,S,w):O(S,w)}l.all=function(y,S){if(!Array.isArray(y))throw new Error("first argument should be an array");return y.reduce(function(w,U){return l(w,U,S)},{})};var E=l;I.exports=E},228:I=>{var h=Object.prototype.hasOwnProperty,x="~";function O(){}function C(l,E,y){this.fn=l,this.context=E,this.once=y||!1}function M(l,E,y,S,w){if(typeof y!="function")throw new TypeError("The listener must be a function");var U=new C(y,S||l,w),q=x?x+E:E;return l._events[q]?l._events[q].fn?l._events[q]=[l._events[q],U]:l._events[q].push(U):(l._events[q]=U,l._eventsCount++),l}function F(l,E){--l._eventsCount==0?l._events=new O:delete l._events[E]}function g(){this._events=new O,this._eventsCount=0}Object.create&&(O.prototype=Object.create(null),new O().__proto__||(x=!1)),g.prototype.eventNames=function(){var l,E,y=[];if(this._eventsCount===0)return y;for(E in l=this._events)h.call(l,E)&&y.push(x?E.slice(1):E);return Object.getOwnPropertySymbols?y.concat(Object.getOwnPropertySymbols(l)):y},g.prototype.listeners=function(l){var E=x?x+l:l,y=this._events[E];if(!y)return[];if(y.fn)return[y.fn];for(var S=0,w=y.length,U=new Array(w);S<w;S++)U[S]=y[S].fn;return U},g.prototype.listenerCount=function(l){var E=x?x+l:l,y=this._events[E];return y?y.fn?1:y.length:0},g.prototype.emit=function(l,E,y,S,w,U){var q=x?x+l:l;if(!this._events[q])return!1;var D,z,a=this._events[q],d=arguments.length;if(a.fn){switch(a.once&&this.removeListener(l,a.fn,void 0,!0),d){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,E),!0;case 3:return a.fn.call(a.context,E,y),!0;case 4:return a.fn.call(a.context,E,y,S),!0;case 5:return a.fn.call(a.context,E,y,S,w),!0;case 6:return a.fn.call(a.context,E,y,S,w,U),!0}for(z=1,D=new Array(d-1);z<d;z++)D[z-1]=arguments[z];a.fn.apply(a.context,D)}else{var _,L=a.length;for(z=0;z<L;z++)switch(a[z].once&&this.removeListener(l,a[z].fn,void 0,!0),d){case 1:a[z].fn.call(a[z].context);break;case 2:a[z].fn.call(a[z].context,E);break;case 3:a[z].fn.call(a[z].context,E,y);break;case 4:a[z].fn.call(a[z].context,E,y,S);break;default:if(!D)for(_=1,D=new Array(d-1);_<d;_++)D[_-1]=arguments[_];a[z].fn.apply(a[z].context,D)}}return!0},g.prototype.on=function(l,E,y){return M(this,l,E,y,!1)},g.prototype.once=function(l,E,y){return M(this,l,E,y,!0)},g.prototype.removeListener=function(l,E,y,S){var w=x?x+l:l;if(!this._events[w])return this;if(!E)return F(this,w),this;var U=this._events[w];if(U.fn)U.fn!==E||S&&!U.once||y&&U.context!==y||F(this,w);else{for(var q=0,D=[],z=U.length;q<z;q++)(U[q].fn!==E||S&&!U[q].once||y&&U[q].context!==y)&&D.push(U[q]);D.length?this._events[w]=D.length===1?D[0]:D:F(this,w)}return this},g.prototype.removeAllListeners=function(l){var E;return l?(E=x?x+l:l,this._events[E]&&F(this,E)):(this._events=new O,this._eventsCount=0),this},g.prototype.off=g.prototype.removeListener,g.prototype.addListener=g.prototype.on,g.prefixed=x,g.EventEmitter=g,I.exports=g},698:I=>{typeof Object.create=="function"?I.exports=function(h,x){h.super_=x,h.prototype=Object.create(x.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}})}:I.exports=function(h,x){h.super_=x;var O=function(){};O.prototype=x.prototype,h.prototype=new O,h.prototype.constructor=h}},585:I=>{var h=1e3,x=60*h,O=60*x,C=24*O,M=7*C,F=365.25*C;function g(l,E,y,S){var w=E>=1.5*y;return Math.round(l/y)+" "+S+(w?"s":"")}I.exports=function(l,E){E=E||{};var y=typeof l;if(y==="string"&&l.length>0)return function(S){if(!((S=String(S)).length>100)){var w=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(S);if(w){var U=parseFloat(w[1]);switch((w[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return U*F;case"weeks":case"week":case"w":return U*M;case"days":case"day":case"d":return U*C;case"hours":case"hour":case"hrs":case"hr":case"h":return U*O;case"minutes":case"minute":case"mins":case"min":case"m":return U*x;case"seconds":case"second":case"secs":case"sec":case"s":return U*h;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return U;default:return}}}}(l);if(y==="number"&&isFinite(l))return E.long?function(S){var w=Math.abs(S);return w>=C?g(S,w,C,"day"):w>=O?g(S,w,O,"hour"):w>=x?g(S,w,x,"minute"):w>=h?g(S,w,h,"second"):S+" ms"}(l):function(S){var w=Math.abs(S);return w>=C?Math.round(S/C)+"d":w>=O?Math.round(S/O)+"h":w>=x?Math.round(S/x)+"m":w>=h?Math.round(S/h)+"s":S+"ms"}(l);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(l))}},627:(I,h,x)=>{var O=x(606),C=O.platform==="win32",M=x(537);function F(a,d){for(var _=[],L=0;L<a.length;L++){var X=a[L];X&&X!=="."&&(X===".."?_.length&&_[_.length-1]!==".."?_.pop():d&&_.push(".."):_.push(X))}return _}function g(a){for(var d=a.length-1,_=0;_<=d&&!a[_];_++);for(var L=d;L>=0&&!a[L];L--);return _===0&&L===d?a:_>L?[]:a.slice(_,L+1)}var l=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,E=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,y={};function S(a){var d=l.exec(a),_=(d[1]||"")+(d[2]||""),L=d[3]||"",X=E.exec(L);return[_,X[1],X[2],X[3]]}function w(a){var d=l.exec(a),_=d[1]||"",L=!!_&&_[1]!==":";return{device:_,isUnc:L,isAbsolute:L||!!d[2],tail:d[3]}}function U(a){return"\\\\"+a.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}y.resolve=function(){for(var a="",d="",_=!1,L=arguments.length-1;L>=-1;L--){var X;if(L>=0?X=arguments[L]:a?(X=O.env["="+a])&&X.substr(0,3).toLowerCase()===a.toLowerCase()+"\\"||(X=a+"\\"):X=O.cwd(),!M.isString(X))throw new TypeError("Arguments to path.resolve must be strings");if(X){var Z=w(X),J=Z.device,pt=Z.isUnc,Et=Z.isAbsolute,tt=Z.tail;if((!J||!a||J.toLowerCase()===a.toLowerCase())&&(a||(a=J),_||(d=tt+"\\"+d,_=Et),a&&_))break}}return pt&&(a=U(a)),a+(_?"\\":"")+(d=F(d.split(/[\\\/]+/),!_).join("\\"))||"."},y.normalize=function(a){var d=w(a),_=d.device,L=d.isUnc,X=d.isAbsolute,Z=d.tail,J=/[\\\/]$/.test(Z);return(Z=F(Z.split(/[\\\/]+/),!X).join("\\"))||X||(Z="."),Z&&J&&(Z+="\\"),L&&(_=U(_)),_+(X?"\\":"")+Z},y.isAbsolute=function(a){return w(a).isAbsolute},y.join=function(){for(var a=[],d=0;d<arguments.length;d++){var _=arguments[d];if(!M.isString(_))throw new TypeError("Arguments to path.join must be strings");_&&a.push(_)}var L=a.join("\\");return/^[\\\/]{2}[^\\\/]/.test(a[0])||(L=L.replace(/^[\\\/]{2,}/,"\\")),y.normalize(L)},y.relative=function(a,d){a=y.resolve(a),d=y.resolve(d);for(var _=a.toLowerCase(),L=d.toLowerCase(),X=g(d.split("\\")),Z=g(_.split("\\")),J=g(L.split("\\")),pt=Math.min(Z.length,J.length),Et=pt,tt=0;tt<pt;tt++)if(Z[tt]!==J[tt]){Et=tt;break}if(Et==0)return d;var G=[];for(tt=Et;tt<Z.length;tt++)G.push("..");return(G=G.concat(X.slice(Et))).join("\\")},y._makeLong=function(a){if(!M.isString(a))return a;if(!a)return"";var d=y.resolve(a);return/^[a-zA-Z]\:\\/.test(d)?"\\\\?\\"+d:/^\\\\[^?.]/.test(d)?"\\\\?\\UNC\\"+d.substring(2):a},y.dirname=function(a){var d=S(a),_=d[0],L=d[1];return _||L?(L&&(L=L.substr(0,L.length-1)),_+L):"."},y.basename=function(a,d){var _=S(a)[2];return d&&_.substr(-1*d.length)===d&&(_=_.substr(0,_.length-d.length)),_},y.extname=function(a){return S(a)[3]},y.format=function(a){if(!M.isObject(a))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof a);var d=a.root||"";if(!M.isString(d))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof a.root);var _=a.dir,L=a.base||"";return _?_[_.length-1]===y.sep?_+L:_+y.sep+L:L},y.parse=function(a){if(!M.isString(a))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof a);var d=S(a);if(!d||d.length!==4)throw new TypeError("Invalid path '"+a+"'");return{root:d[0],dir:d[0]+d[1].slice(0,-1),base:d[2],ext:d[3],name:d[2].slice(0,d[2].length-d[3].length)}},y.sep="\\",y.delimiter=";";var q=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,D={};function z(a){return q.exec(a).slice(1)}D.resolve=function(){for(var a="",d=!1,_=arguments.length-1;_>=-1&&!d;_--){var L=_>=0?arguments[_]:O.cwd();if(!M.isString(L))throw new TypeError("Arguments to path.resolve must be strings");L&&(a=L+"/"+a,d=L[0]==="/")}return(d?"/":"")+(a=F(a.split("/"),!d).join("/"))||"."},D.normalize=function(a){var d=D.isAbsolute(a),_=a&&a[a.length-1]==="/";return(a=F(a.split("/"),!d).join("/"))||d||(a="."),a&&_&&(a+="/"),(d?"/":"")+a},D.isAbsolute=function(a){return a.charAt(0)==="/"},D.join=function(){for(var a="",d=0;d<arguments.length;d++){var _=arguments[d];if(!M.isString(_))throw new TypeError("Arguments to path.join must be strings");_&&(a+=a?"/"+_:_)}return D.normalize(a)},D.relative=function(a,d){a=D.resolve(a).substr(1),d=D.resolve(d).substr(1);for(var _=g(a.split("/")),L=g(d.split("/")),X=Math.min(_.length,L.length),Z=X,J=0;J<X;J++)if(_[J]!==L[J]){Z=J;break}var pt=[];for(J=Z;J<_.length;J++)pt.push("..");return(pt=pt.concat(L.slice(Z))).join("/")},D._makeLong=function(a){return a},D.dirname=function(a){var d=z(a),_=d[0],L=d[1];return _||L?(L&&(L=L.substr(0,L.length-1)),_+L):"."},D.basename=function(a,d){var _=z(a)[2];return d&&_.substr(-1*d.length)===d&&(_=_.substr(0,_.length-d.length)),_},D.extname=function(a){return z(a)[3]},D.format=function(a){if(!M.isObject(a))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof a);var d=a.root||"";if(!M.isString(d))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof a.root);return(a.dir?a.dir+D.sep:"")+(a.base||"")},D.parse=function(a){if(!M.isString(a))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof a);var d=z(a);if(!d||d.length!==4)throw new TypeError("Invalid path '"+a+"'");return d[1]=d[1]||"",d[2]=d[2]||"",d[3]=d[3]||"",{root:d[0],dir:d[0]+d[1].slice(0,-1),base:d[2],ext:d[3],name:d[2].slice(0,d[2].length-d[3].length)}},D.sep="/",D.delimiter=":",I.exports=C?y:D,I.exports.posix=D,I.exports.win32=y},606:I=>{var h,x,O=I.exports={};function C(){throw new Error("setTimeout has not been defined")}function M(){throw new Error("clearTimeout has not been defined")}function F(D){if(h===setTimeout)return setTimeout(D,0);if((h===C||!h)&&setTimeout)return h=setTimeout,setTimeout(D,0);try{return h(D,0)}catch{try{return h.call(null,D,0)}catch{return h.call(this,D,0)}}}(function(){try{h=typeof setTimeout=="function"?setTimeout:C}catch{h=C}try{x=typeof clearTimeout=="function"?clearTimeout:M}catch{x=M}})();var g,l=[],E=!1,y=-1;function S(){E&&g&&(E=!1,g.length?l=g.concat(l):y=-1,l.length&&w())}function w(){if(!E){var D=F(S);E=!0;for(var z=l.length;z;){for(g=l,l=[];++y<z;)g&&g[y].run();y=-1,z=l.length}g=null,E=!1,function(a){if(x===clearTimeout)return clearTimeout(a);if((x===M||!x)&&clearTimeout)return x=clearTimeout,clearTimeout(a);try{x(a)}catch{try{return x.call(null,a)}catch{return x.call(this,a)}}}(D)}}function U(D,z){this.fun=D,this.array=z}function q(){}O.nextTick=function(D){var z=new Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)z[a-1]=arguments[a];l.push(new U(D,z)),l.length!==1||E||F(w)},U.prototype.run=function(){this.fun.apply(null,this.array)},O.title="browser",O.browser=!0,O.env={},O.argv=[],O.version="",O.versions={},O.on=q,O.addListener=q,O.once=q,O.off=q,O.removeListener=q,O.removeAllListeners=q,O.emit=q,O.prependListener=q,O.prependOnceListener=q,O.listeners=function(D){return[]},O.binding=function(D){throw new Error("process.binding is not supported")},O.cwd=function(){return"/"},O.chdir=function(D){throw new Error("process.chdir is not supported")},O.umask=function(){return 0}},135:I=>{I.exports=function(h){return h&&typeof h=="object"&&typeof h.copy=="function"&&typeof h.fill=="function"&&typeof h.readUInt8=="function"}},537:(I,h,x)=>{var O=x(606),C=/%[sdj%]/g;h.format=function(f){if(!a(f)){for(var j=[],B=0;B<arguments.length;B++)j.push(g(arguments[B]));return j.join(" ")}B=1;for(var lt=arguments,bt=lt.length,gt=String(f).replace(C,function(dt){if(dt==="%%")return"%";if(B>=bt)return dt;switch(dt){case"%s":return String(lt[B++]);case"%d":return Number(lt[B++]);case"%j":try{return JSON.stringify(lt[B++])}catch{return"[Circular]"}default:return dt}}),rt=lt[B];B<bt;rt=lt[++B])D(rt)||!L(rt)?gt+=" "+rt:gt+=" "+g(rt);return gt},h.deprecate=function(f,j){if(d(x.g.process))return function(){return h.deprecate(f,j).apply(this,arguments)};if(O.noDeprecation===!0)return f;var B=!1;return function(){if(!B){if(O.throwDeprecation)throw new Error(j);O.traceDeprecation?console.trace(j):console.error(j),B=!0}return f.apply(this,arguments)}};var M,F={};function g(f,j){var B={seen:[],stylize:E};return arguments.length>=3&&(B.depth=arguments[2]),arguments.length>=4&&(B.colors=arguments[3]),q(j)?B.showHidden=j:j&&h._extend(B,j),d(B.showHidden)&&(B.showHidden=!1),d(B.depth)&&(B.depth=2),d(B.colors)&&(B.colors=!1),d(B.customInspect)&&(B.customInspect=!0),B.colors&&(B.stylize=l),y(B,f,B.depth)}function l(f,j){var B=g.styles[j];return B?"\x1B["+g.colors[B][0]+"m"+f+"\x1B["+g.colors[B][1]+"m":f}function E(f,j){return f}function y(f,j,B){if(f.customInspect&&j&&J(j.inspect)&&j.inspect!==h.inspect&&(!j.constructor||j.constructor.prototype!==j)){var lt=j.inspect(B,f);return a(lt)||(lt=y(f,lt,B)),lt}var bt=function(ct,at){if(d(at))return ct.stylize("undefined","undefined");if(a(at)){var xt="'"+JSON.stringify(at).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ct.stylize(xt,"string")}if(z(at))return ct.stylize(""+at,"number");if(q(at))return ct.stylize(""+at,"boolean");if(D(at))return ct.stylize("null","null")}(f,j);if(bt)return bt;var gt=Object.keys(j),rt=function(ct){var at={};return ct.forEach(function(xt,Jt){at[xt]=!0}),at}(gt);if(f.showHidden&&(gt=Object.getOwnPropertyNames(j)),Z(j)&&(gt.indexOf("message")>=0||gt.indexOf("description")>=0))return S(j);if(gt.length===0){if(J(j)){var dt=j.name?": "+j.name:"";return f.stylize("[Function"+dt+"]","special")}if(_(j))return f.stylize(RegExp.prototype.toString.call(j),"regexp");if(X(j))return f.stylize(Date.prototype.toString.call(j),"date");if(Z(j))return S(j)}var St,kt="",qt=!1,Yt=["{","}"];return U(j)&&(qt=!0,Yt=["[","]"]),J(j)&&(kt=" [Function"+(j.name?": "+j.name:"")+"]"),_(j)&&(kt=" "+RegExp.prototype.toString.call(j)),X(j)&&(kt=" "+Date.prototype.toUTCString.call(j)),Z(j)&&(kt=" "+S(j)),gt.length!==0||qt&&j.length!=0?B<0?_(j)?f.stylize(RegExp.prototype.toString.call(j),"regexp"):f.stylize("[Object]","special"):(f.seen.push(j),St=qt?function(ct,at,xt,Jt,oe){for(var ie=[],Zt=0,fn=at.length;Zt<fn;++Zt)Fe(at,String(Zt))?ie.push(w(ct,at,xt,Jt,String(Zt),!0)):ie.push("");return oe.forEach(function(Ne){Ne.match(/^\d+$/)||ie.push(w(ct,at,xt,Jt,Ne,!0))}),ie}(f,j,B,rt,gt):gt.map(function(ct){return w(f,j,B,rt,ct,qt)}),f.seen.pop(),function(ct,at,xt){return ct.reduce(function(Jt,oe){return oe.indexOf(`
`)>=0,Jt+oe.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?xt[0]+(at===""?"":at+`
 `)+" "+ct.join(`,
  `)+" "+xt[1]:xt[0]+at+" "+ct.join(", ")+" "+xt[1]}(St,kt,Yt)):Yt[0]+kt+Yt[1]}function S(f){return"["+Error.prototype.toString.call(f)+"]"}function w(f,j,B,lt,bt,gt){var rt,dt,St;if((St=Object.getOwnPropertyDescriptor(j,bt)||{value:j[bt]}).get?dt=St.set?f.stylize("[Getter/Setter]","special"):f.stylize("[Getter]","special"):St.set&&(dt=f.stylize("[Setter]","special")),Fe(lt,bt)||(rt="["+bt+"]"),dt||(f.seen.indexOf(St.value)<0?(dt=D(B)?y(f,St.value,null):y(f,St.value,B-1)).indexOf(`
`)>-1&&(dt=gt?dt.split(`
`).map(function(kt){return"  "+kt}).join(`
`).substr(2):`
`+dt.split(`
`).map(function(kt){return"   "+kt}).join(`
`)):dt=f.stylize("[Circular]","special")),d(rt)){if(gt&&bt.match(/^\d+$/))return dt;(rt=JSON.stringify(""+bt)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(rt=rt.substr(1,rt.length-2),rt=f.stylize(rt,"name")):(rt=rt.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),rt=f.stylize(rt,"string"))}return rt+": "+dt}function U(f){return Array.isArray(f)}function q(f){return typeof f=="boolean"}function D(f){return f===null}function z(f){return typeof f=="number"}function a(f){return typeof f=="string"}function d(f){return f===void 0}function _(f){return L(f)&&pt(f)==="[object RegExp]"}function L(f){return typeof f=="object"&&f!==null}function X(f){return L(f)&&pt(f)==="[object Date]"}function Z(f){return L(f)&&(pt(f)==="[object Error]"||f instanceof Error)}function J(f){return typeof f=="function"}function pt(f){return Object.prototype.toString.call(f)}function Et(f){return f<10?"0"+f.toString(10):f.toString(10)}h.debuglog=function(f){if(d(M)&&(M=O.env.NODE_DEBUG||""),f=f.toUpperCase(),!F[f])if(new RegExp("\\b"+f+"\\b","i").test(M)){var j=O.pid;F[f]=function(){var B=h.format.apply(h,arguments);console.error("%s %d: %s",f,j,B)}}else F[f]=function(){};return F[f]},h.inspect=g,g.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},g.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},h.isArray=U,h.isBoolean=q,h.isNull=D,h.isNullOrUndefined=function(f){return f==null},h.isNumber=z,h.isString=a,h.isSymbol=function(f){return typeof f=="symbol"},h.isUndefined=d,h.isRegExp=_,h.isObject=L,h.isDate=X,h.isError=Z,h.isFunction=J,h.isPrimitive=function(f){return f===null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||typeof f=="symbol"||f===void 0},h.isBuffer=x(135);var tt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function G(){var f=new Date,j=[Et(f.getHours()),Et(f.getMinutes()),Et(f.getSeconds())].join(":");return[f.getDate(),tt[f.getMonth()],j].join(" ")}function Fe(f,j){return Object.prototype.hasOwnProperty.call(f,j)}h.log=function(){console.log("%s - %s",G(),h.format.apply(h,arguments))},h.inherits=x(698),h._extend=function(f,j){if(!j||!L(j))return f;for(var B=Object.keys(j),lt=B.length;lt--;)f[B[lt]]=j[B[lt]];return f}}},p={};function T(I){var h=p[I];if(h!==void 0)return h.exports;var x=p[I]={exports:{}};return b[I](x,x.exports,T),x.exports}T.n=I=>{var h=I&&I.__esModule?()=>I.default:()=>I;return T.d(h,{a:h}),h},T.d=(I,h)=>{for(var x in h)T.o(h,x)&&!T.o(I,x)&&Object.defineProperty(I,x,{enumerable:!0,get:h[x]})},T.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),T.o=(I,h)=>Object.prototype.hasOwnProperty.call(I,h),T.r=I=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(I,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(I,"__esModule",{value:!0})};var Y={};return(()=>{T.r(Y),T.d(Y,{LSPluginUser:()=>Pn,setupPluginUserInstance:()=>so});var I=T(627);const{entries:h,setPrototypeOf:x,isFrozen:O,getPrototypeOf:C,getOwnPropertyDescriptor:M}=Object;let{freeze:F,seal:g,create:l}=Object,{apply:E,construct:y}=typeof Reflect<"u"&&Reflect;F||(F=function(e){return e}),g||(g=function(e){return e}),E||(E=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return e.apply(t,r)}),y||(y=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new e(...n)});const S=tt(Array.prototype.forEach),w=tt(Array.prototype.lastIndexOf),U=tt(Array.prototype.pop),q=tt(Array.prototype.push),D=tt(Array.prototype.splice),z=tt(String.prototype.toLowerCase),a=tt(String.prototype.toString),d=tt(String.prototype.match),_=tt(String.prototype.replace),L=tt(String.prototype.indexOf),X=tt(String.prototype.trim),Z=tt(Object.prototype.hasOwnProperty),J=tt(RegExp.prototype.test),pt=(Et=TypeError,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return y(Et,t)});var Et;function tt(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return E(e,t,r)}}function G(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:z;x&&x(e,null);let r=t.length;for(;r--;){let i=t[r];if(typeof i=="string"){const s=n(i);s!==i&&(O(t)||(t[r]=s),i=s)}e[i]=!0}return e}function Fe(e){for(let t=0;t<e.length;t++)Z(e,t)||(e[t]=null);return e}function f(e){const t=l(null);for(const[n,r]of h(e))Z(e,n)&&(Array.isArray(r)?t[n]=Fe(r):r&&typeof r=="object"&&r.constructor===Object?t[n]=f(r):t[n]=r);return t}function j(e,t){for(;e!==null;){const n=M(e,t);if(n){if(n.get)return tt(n.get);if(typeof n.value=="function")return tt(n.value)}e=C(e)}return function(){return null}}const B=F(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),lt=F(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),bt=F(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),gt=F(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),rt=F(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),dt=F(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),St=F(["#text"]),kt=F(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),qt=F(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Yt=F(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),ct=F(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),at=g(/\{\{[\w\W]*|[\w\W]*\}\}/gm),xt=g(/<%[\w\W]*|[\w\W]*%>/gm),Jt=g(/\$\{[\w\W]*/gm),oe=g(/^data-[\-\w.\u00B7-\uFFFF]+$/),ie=g(/^aria-[\-\w]+$/),Zt=g(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),fn=g(/^(?:\w+script|data):/i),Ne=g(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),ir=g(/^html$/i),ti=g(/^[a-z][.\w]*(-[.\w]+)+$/i);var ar=Object.freeze({__proto__:null,ARIA_ATTR:ie,ATTR_WHITESPACE:Ne,CUSTOM_ELEMENT:ti,DATA_ATTR:oe,DOCTYPE_NAME:ir,ERB_EXPR:xt,IS_ALLOWED_URI:Zt,IS_SCRIPT_OR_DATA:fn,MUSTACHE_EXPR:at,TMPLIT_EXPR:Jt});const ei=1,ni=3,ri=7,oi=8,ii=9,ai=function(){return typeof window>"u"?null:window},si=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let n=null;const r="data-tt-policy-suffix";t&&t.hasAttribute(r)&&(n=t.getAttribute(r));const i="dompurify"+(n?"#"+n:"");try{return e.createPolicy(i,{createHTML:s=>s,createScriptURL:s=>s})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}};(function e(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ai();const n=o=>e(o);if(n.version="3.3.1",n.removed=[],!t||!t.document||t.document.nodeType!==ii||!t.Element)return n.isSupported=!1,n;let{document:r}=t;const i=r,s=i.currentScript,{DocumentFragment:u,HTMLTemplateElement:v,Node:A,Element:N,NodeFilter:$,NamedNodeMap:R=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:H,DOMParser:V,trustedTypes:W}=t,K=N.prototype,et=j(K,"cloneNode"),st=j(K,"remove"),Ct=j(K,"nextSibling"),Ft=j(K,"childNodes"),en=j(K,"parentNode");if(typeof v=="function"){const o=r.createElement("template");o.content&&o.content.ownerDocument&&(r=o.content.ownerDocument)}let _t,Oe="";const{implementation:Dn,createNodeIterator:Fs,createDocumentFragment:Ns,getElementsByTagName:Rs}=r,{importNode:Us}=i;let wt={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};n.isSupported=typeof h=="function"&&typeof en=="function"&&Dn&&Dn.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Ln,ERB_EXPR:Fn,TMPLIT_EXPR:Nn,DATA_ATTR:$s,ARIA_ATTR:qs,IS_SCRIPT_OR_DATA:zs,ATTR_WHITESPACE:lo,CUSTOM_ELEMENT:Bs}=ar;let{IS_ALLOWED_URI:co}=ar,ht=null;const uo=G({},[...B,...lt,...bt,...rt,...St]);let mt=null;const fo=G({},[...kt,...qt,...Yt,...ct]);let ut=Object.seal(l(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Ie=null,Rn=null;const ge=Object.seal(l(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let po=!0,Un=!0,ho=!1,go=!0,me=!1,nn=!0,Qt=!1,$n=!1,qn=!1,ye=!1,rn=!1,on=!1,mo=!0,yo=!1;const Hs="user-content-";let zn=!0,je=!1,ve={},Mt=null;const Bn=G({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let vo=null;const bo=G({},["audio","video","img","source","image","track"]);let Hn=null;const _o=G({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),an="http://www.w3.org/1998/Math/MathML",sn="http://www.w3.org/2000/svg",Nt="http://www.w3.org/1999/xhtml";let be=Nt,Wn=!1,Gn=null;const Ws=G({},[an,sn,Nt],a);let ln=G({},["mi","mo","mn","ms","mtext"]),cn=G({},["annotation-xml"]);const Gs=G({},["title","style","font","a","script"]);let Me=null;const Ys=["application/xhtml+xml","text/html"],Js="text/html";let ft=null,_e=null;const Zs=r.createElement("form"),wo=function(o){return o instanceof RegExp||o instanceof Function},Yn=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!_e||_e!==o){if(o&&typeof o=="object"||(o={}),o=f(o),Me=Ys.indexOf(o.PARSER_MEDIA_TYPE)===-1?Js:o.PARSER_MEDIA_TYPE,ft=Me==="application/xhtml+xml"?a:z,ht=Z(o,"ALLOWED_TAGS")?G({},o.ALLOWED_TAGS,ft):uo,mt=Z(o,"ALLOWED_ATTR")?G({},o.ALLOWED_ATTR,ft):fo,Gn=Z(o,"ALLOWED_NAMESPACES")?G({},o.ALLOWED_NAMESPACES,a):Ws,Hn=Z(o,"ADD_URI_SAFE_ATTR")?G(f(_o),o.ADD_URI_SAFE_ATTR,ft):_o,vo=Z(o,"ADD_DATA_URI_TAGS")?G(f(bo),o.ADD_DATA_URI_TAGS,ft):bo,Mt=Z(o,"FORBID_CONTENTS")?G({},o.FORBID_CONTENTS,ft):Bn,Ie=Z(o,"FORBID_TAGS")?G({},o.FORBID_TAGS,ft):f({}),Rn=Z(o,"FORBID_ATTR")?G({},o.FORBID_ATTR,ft):f({}),ve=!!Z(o,"USE_PROFILES")&&o.USE_PROFILES,po=o.ALLOW_ARIA_ATTR!==!1,Un=o.ALLOW_DATA_ATTR!==!1,ho=o.ALLOW_UNKNOWN_PROTOCOLS||!1,go=o.ALLOW_SELF_CLOSE_IN_ATTR!==!1,me=o.SAFE_FOR_TEMPLATES||!1,nn=o.SAFE_FOR_XML!==!1,Qt=o.WHOLE_DOCUMENT||!1,ye=o.RETURN_DOM||!1,rn=o.RETURN_DOM_FRAGMENT||!1,on=o.RETURN_TRUSTED_TYPE||!1,qn=o.FORCE_BODY||!1,mo=o.SANITIZE_DOM!==!1,yo=o.SANITIZE_NAMED_PROPS||!1,zn=o.KEEP_CONTENT!==!1,je=o.IN_PLACE||!1,co=o.ALLOWED_URI_REGEXP||Zt,be=o.NAMESPACE||Nt,ln=o.MATHML_TEXT_INTEGRATION_POINTS||ln,cn=o.HTML_INTEGRATION_POINTS||cn,ut=o.CUSTOM_ELEMENT_HANDLING||{},o.CUSTOM_ELEMENT_HANDLING&&wo(o.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ut.tagNameCheck=o.CUSTOM_ELEMENT_HANDLING.tagNameCheck),o.CUSTOM_ELEMENT_HANDLING&&wo(o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ut.attributeNameCheck=o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),o.CUSTOM_ELEMENT_HANDLING&&typeof o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ut.allowCustomizedBuiltInElements=o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),me&&(Un=!1),rn&&(ye=!0),ve&&(ht=G({},St),mt=[],ve.html===!0&&(G(ht,B),G(mt,kt)),ve.svg===!0&&(G(ht,lt),G(mt,qt),G(mt,ct)),ve.svgFilters===!0&&(G(ht,bt),G(mt,qt),G(mt,ct)),ve.mathMl===!0&&(G(ht,rt),G(mt,Yt),G(mt,ct))),o.ADD_TAGS&&(typeof o.ADD_TAGS=="function"?ge.tagCheck=o.ADD_TAGS:(ht===uo&&(ht=f(ht)),G(ht,o.ADD_TAGS,ft))),o.ADD_ATTR&&(typeof o.ADD_ATTR=="function"?ge.attributeCheck=o.ADD_ATTR:(mt===fo&&(mt=f(mt)),G(mt,o.ADD_ATTR,ft))),o.ADD_URI_SAFE_ATTR&&G(Hn,o.ADD_URI_SAFE_ATTR,ft),o.FORBID_CONTENTS&&(Mt===Bn&&(Mt=f(Mt)),G(Mt,o.FORBID_CONTENTS,ft)),o.ADD_FORBID_CONTENTS&&(Mt===Bn&&(Mt=f(Mt)),G(Mt,o.ADD_FORBID_CONTENTS,ft)),zn&&(ht["#text"]=!0),Qt&&G(ht,["html","head","body"]),ht.table&&(G(ht,["tbody"]),delete Ie.tbody),o.TRUSTED_TYPES_POLICY){if(typeof o.TRUSTED_TYPES_POLICY.createHTML!="function")throw pt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof o.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw pt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');_t=o.TRUSTED_TYPES_POLICY,Oe=_t.createHTML("")}else _t===void 0&&(_t=si(W,s)),_t!==null&&typeof Oe=="string"&&(Oe=_t.createHTML(""));F&&F(o),_e=o}},Co=G({},[...lt,...bt,...gt]),Eo=G({},[...rt,...dt]),Vs=function(o){let P=en(o);P&&P.tagName||(P={namespaceURI:be,tagName:"template"});const k=z(o.tagName),Q=z(P.tagName);return!!Gn[o.namespaceURI]&&(o.namespaceURI===sn?P.namespaceURI===Nt?k==="svg":P.namespaceURI===an?k==="svg"&&(Q==="annotation-xml"||ln[Q]):!!Co[k]:o.namespaceURI===an?P.namespaceURI===Nt?k==="math":P.namespaceURI===sn?k==="math"&&cn[Q]:!!Eo[k]:o.namespaceURI===Nt?!(P.namespaceURI===sn&&!cn[Q])&&!(P.namespaceURI===an&&!ln[Q])&&!Eo[k]&&(Gs[k]||!Co[k]):!(Me!=="application/xhtml+xml"||!Gn[o.namespaceURI]))},Pt=function(o){q(n.removed,{element:o});try{en(o).removeChild(o)}catch{st(o)}},te=function(o,P){try{q(n.removed,{attribute:P.getAttributeNode(o),from:P})}catch{q(n.removed,{attribute:null,from:P})}if(P.removeAttribute(o),o==="is")if(ye||rn)try{Pt(P)}catch{}else try{P.setAttribute(o,"")}catch{}},So=function(o){let P=null,k=null;if(qn)o="<remove></remove>"+o;else{const nt=d(o,/^[\r\n\t ]+/);k=nt&&nt[0]}Me==="application/xhtml+xml"&&be===Nt&&(o='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+o+"</body></html>");const Q=_t?_t.createHTML(o):o;if(be===Nt)try{P=new V().parseFromString(Q,Me)}catch{}if(!P||!P.documentElement){P=Dn.createDocument(be,"template",null);try{P.documentElement.innerHTML=Wn?Oe:Q}catch{}}const yt=P.body||P.documentElement;return o&&k&&yt.insertBefore(r.createTextNode(k),yt.childNodes[0]||null),be===Nt?Rs.call(P,Qt?"html":"body")[0]:Qt?P.documentElement:yt},ko=function(o){return Fs.call(o.ownerDocument||o,o,$.SHOW_ELEMENT|$.SHOW_COMMENT|$.SHOW_TEXT|$.SHOW_PROCESSING_INSTRUCTION|$.SHOW_CDATA_SECTION,null)},Jn=function(o){return o instanceof H&&(typeof o.nodeName!="string"||typeof o.textContent!="string"||typeof o.removeChild!="function"||!(o.attributes instanceof R)||typeof o.removeAttribute!="function"||typeof o.setAttribute!="function"||typeof o.namespaceURI!="string"||typeof o.insertBefore!="function"||typeof o.hasChildNodes!="function")},xo=function(o){return typeof A=="function"&&o instanceof A};function Rt(o,P,k){S(o,Q=>{Q.call(n,P,k,_e)})}const Ao=function(o){let P=null;if(Rt(wt.beforeSanitizeElements,o,null),Jn(o))return Pt(o),!0;const k=ft(o.nodeName);if(Rt(wt.uponSanitizeElement,o,{tagName:k,allowedTags:ht}),nn&&o.hasChildNodes()&&!xo(o.firstElementChild)&&J(/<[/\w!]/g,o.innerHTML)&&J(/<[/\w!]/g,o.textContent)||o.nodeType===ri||nn&&o.nodeType===oi&&J(/<[/\w]/g,o.data))return Pt(o),!0;if(!(ge.tagCheck instanceof Function&&ge.tagCheck(k))&&(!ht[k]||Ie[k])){if(!Ie[k]&&Oo(k)&&(ut.tagNameCheck instanceof RegExp&&J(ut.tagNameCheck,k)||ut.tagNameCheck instanceof Function&&ut.tagNameCheck(k)))return!1;if(zn&&!Mt[k]){const Q=en(o)||o.parentNode,yt=Ft(o)||o.childNodes;if(yt&&Q)for(let nt=yt.length-1;nt>=0;--nt){const Wt=et(yt[nt],!0);Wt.__removalCount=(o.__removalCount||0)+1,Q.insertBefore(Wt,Ct(o))}}return Pt(o),!0}return o instanceof N&&!Vs(o)?(Pt(o),!0):k!=="noscript"&&k!=="noembed"&&k!=="noframes"||!J(/<\/no(script|embed|frames)/i,o.innerHTML)?(me&&o.nodeType===ni&&(P=o.textContent,S([Ln,Fn,Nn],Q=>{P=_(P,Q," ")}),o.textContent!==P&&(q(n.removed,{element:o.cloneNode()}),o.textContent=P)),Rt(wt.afterSanitizeElements,o,null),!1):(Pt(o),!0)},To=function(o,P,k){if(mo&&(P==="id"||P==="name")&&(k in r||k in Zs))return!1;if(!(Un&&!Rn[P]&&J($s,P))){if(!(po&&J(qs,P))){if(!(ge.attributeCheck instanceof Function&&ge.attributeCheck(P,o))){if(!mt[P]||Rn[P]){if(!(Oo(o)&&(ut.tagNameCheck instanceof RegExp&&J(ut.tagNameCheck,o)||ut.tagNameCheck instanceof Function&&ut.tagNameCheck(o))&&(ut.attributeNameCheck instanceof RegExp&&J(ut.attributeNameCheck,P)||ut.attributeNameCheck instanceof Function&&ut.attributeNameCheck(P,o))||P==="is"&&ut.allowCustomizedBuiltInElements&&(ut.tagNameCheck instanceof RegExp&&J(ut.tagNameCheck,k)||ut.tagNameCheck instanceof Function&&ut.tagNameCheck(k))))return!1}else if(!Hn[P]){if(!J(co,_(k,lo,""))){if((P!=="src"&&P!=="xlink:href"&&P!=="href"||o==="script"||L(k,"data:")!==0||!vo[o])&&!(ho&&!J(zs,_(k,lo,"")))){if(k)return!1}}}}}}return!0},Oo=function(o){return o!=="annotation-xml"&&d(o,Bs)},Io=function(o){Rt(wt.beforeSanitizeAttributes,o,null);const{attributes:P}=o;if(!P||Jn(o))return;const k={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:mt,forceKeepAttr:void 0};let Q=P.length;for(;Q--;){const yt=P[Q],{name:nt,namespaceURI:Wt,value:Gt}=yt,Tt=ft(nt),Zn=Gt;let vt=nt==="value"?Zn:X(Zn);if(k.attrName=Tt,k.attrValue=vt,k.keepAttr=!0,k.forceKeepAttr=void 0,Rt(wt.uponSanitizeAttribute,o,k),vt=k.attrValue,!yo||Tt!=="id"&&Tt!=="name"||(te(nt,o),vt=Hs+vt),nn&&J(/((--!?|])>)|<\/(style|title|textarea)/i,vt)){te(nt,o);continue}if(Tt==="attributename"&&d(vt,"href")){te(nt,o);continue}if(k.forceKeepAttr)continue;if(!k.keepAttr){te(nt,o);continue}if(!go&&J(/\/>/i,vt)){te(nt,o);continue}me&&S([Ln,Fn,Nn],Mo=>{vt=_(vt,Mo," ")});const jo=ft(o.nodeName);if(To(jo,Tt,vt)){if(_t&&typeof W=="object"&&typeof W.getAttributeType=="function"&&!Wt)switch(W.getAttributeType(jo,Tt)){case"TrustedHTML":vt=_t.createHTML(vt);break;case"TrustedScriptURL":vt=_t.createScriptURL(vt)}if(vt!==Zn)try{Wt?o.setAttributeNS(Wt,nt,vt):o.setAttribute(nt,vt),Jn(o)?Pt(o):U(n.removed)}catch{te(nt,o)}}else te(nt,o)}Rt(wt.afterSanitizeAttributes,o,null)},Ks=function o(P){let k=null;const Q=ko(P);for(Rt(wt.beforeSanitizeShadowDOM,P,null);k=Q.nextNode();)Rt(wt.uponSanitizeShadowNode,k,null),Ao(k),Io(k),k.content instanceof u&&o(k.content);Rt(wt.afterSanitizeShadowDOM,P,null)};return n.sanitize=function(o){let P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},k=null,Q=null,yt=null,nt=null;if(Wn=!o,Wn&&(o="<!-->"),typeof o!="string"&&!xo(o)){if(typeof o.toString!="function")throw pt("toString is not a function");if(typeof(o=o.toString())!="string")throw pt("dirty is not a string, aborting")}if(!n.isSupported)return o;if($n||Yn(P),n.removed=[],typeof o=="string"&&(je=!1),je){if(o.nodeName){const Tt=ft(o.nodeName);if(!ht[Tt]||Ie[Tt])throw pt("root node is forbidden and cannot be sanitized in-place")}}else if(o instanceof A)k=So("<!---->"),Q=k.ownerDocument.importNode(o,!0),Q.nodeType===ei&&Q.nodeName==="BODY"||Q.nodeName==="HTML"?k=Q:k.appendChild(Q);else{if(!ye&&!me&&!Qt&&o.indexOf("<")===-1)return _t&&on?_t.createHTML(o):o;if(k=So(o),!k)return ye?null:on?Oe:""}k&&qn&&Pt(k.firstChild);const Wt=ko(je?o:k);for(;yt=Wt.nextNode();)Ao(yt),Io(yt),yt.content instanceof u&&Ks(yt.content);if(je)return o;if(ye){if(rn)for(nt=Ns.call(k.ownerDocument);k.firstChild;)nt.appendChild(k.firstChild);else nt=k;return(mt.shadowroot||mt.shadowrootmode)&&(nt=Us.call(i,nt,!0)),nt}let Gt=Qt?k.outerHTML:k.innerHTML;return Qt&&ht["!doctype"]&&k.ownerDocument&&k.ownerDocument.doctype&&k.ownerDocument.doctype.name&&J(ir,k.ownerDocument.doctype.name)&&(Gt="<!DOCTYPE "+k.ownerDocument.doctype.name+`>
`+Gt),me&&S([Ln,Fn,Nn],Tt=>{Gt=_(Gt,Tt," ")}),_t&&on?_t.createHTML(Gt):Gt},n.setConfig=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Yn(o),$n=!0},n.clearConfig=function(){_e=null,$n=!1},n.isValidAttribute=function(o,P,k){_e||Yn({});const Q=ft(o),yt=ft(P);return To(Q,yt,k)},n.addHook=function(o,P){typeof P=="function"&&q(wt[o],P)},n.removeHook=function(o,P){if(P!==void 0){const k=w(wt[o],P);return k===-1?void 0:D(wt[o],k,1)[0]}return U(wt[o])},n.removeHooks=function(o){wt[o]=[]},n.removeAllHooks=function(){wt={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},n})();var li=T(744),ci=T.n(li),Re=function(){return Re=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Re.apply(this,arguments)};function ui(e){return e.toLowerCase()}var di=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],fi=/[^A-Z0-9]+/gi;function sr(e,t,n){return t instanceof RegExp?e.replace(t,n):t.reduce(function(r,i){return r.replace(i,n)},e)}function pi(e,t){return t===void 0&&(t={}),function(n,r){r===void 0&&(r={});for(var i=r.splitRegexp,s=i===void 0?di:i,u=r.stripRegexp,v=u===void 0?fi:u,A=r.transform,N=A===void 0?ui:A,$=r.delimiter,R=$===void 0?" ":$,H=sr(sr(n,s,"$1\0$2"),v,"\0"),V=0,W=H.length;H.charAt(V)==="\0";)V++;for(;H.charAt(W-1)==="\0";)W--;return H.slice(V,W).split("\0").map(N).join(R)}(e,Re({delimiter:"."},t))}var lr=T(228),Ue=T.n(lr);function pn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const cr=navigator.platform.toLowerCase()==="win32"?I.win32:I.posix,ae=function(e,t){return t===void 0&&(t={}),pi(e,Re({delimiter:"_"},t))};class hi extends Ue(){constructor(t,n){super(),pn(this,"_tag",void 0),pn(this,"_opts",void 0),pn(this,"_logs",[]),this._tag=t,this._opts=n}write(t,n,r){var i;n!=null&&n.length&&n[n.length-1]===!0&&(r=!0,n.pop());const s=n.reduce((v,A)=>(A&&A instanceof Error?v+=`${A.message} ${A.stack}`:v+=A.toString(),v),`[${this._tag}][${new Date().toLocaleTimeString()}] `);var u;this._logs.push([t,s]),(r||(i=this._opts)!==null&&i!==void 0&&i.console)&&((u=console)===null||u===void 0||u[t==="ERROR"?"error":"debug"](`${t}: ${s}`)),this.emit("change")}clear(){this._logs=[],this.emit("change")}info(...t){this.write("INFO",t)}error(...t){this.write("ERROR",t)}warn(...t){this.write("WARN",t)}setTag(t){this._tag=t}toJSON(){return this._logs}}function gi(e,...t){try{const n=new URL(e);if(!n.origin)throw new Error(null);const r=cr.join(e.substr(n.origin.length),...t);return n.origin+r}catch{return cr.join(e,...t)}}function hn(e,t){let n,r,i=!1;const s=v=>A=>{e&&clearTimeout(e),v(A),i=!0},u=new Promise((v,A)=>{n=s(v),r=s(A),e&&(e=setTimeout(()=>r(new Error(`[deferred timeout] ${t}`)),e))});return{created:Date.now(),setTag:v=>t=v,resolve:n,reject:r,promise:u,get settled(){return i}}}const mi=new Map;window.__injectedUIEffects=mi;var yi=T(833),ur=T.n(yi);function it(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const zt="application/x-postmate-v1+json";let vi=0;const bi={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},gn=(e,t)=>(typeof t!="string"||e.origin===t)&&!!e.data&&(typeof e.data!="object"||"postmate"in e.data)&&e.data.type===zt&&!!bi[e.data.postmate];class _i{constructor(t){it(this,"parent",void 0),it(this,"frame",void 0),it(this,"child",void 0),it(this,"events",{}),it(this,"childOrigin",void 0),it(this,"listener",void 0),this.parent=t.parent,this.frame=t.frame,this.child=t.child,this.childOrigin=t.childOrigin,this.listener=n=>{if(!gn(n,this.childOrigin))return!1;const{data:r,name:i}=((n||{}).data||{}).value||{};n.data.postmate==="emit"&&i in this.events&&this.events[i].forEach(s=>{s.call(this,r)})},this.parent.addEventListener("message",this.listener,!1)}get(t,...n){return new Promise((r,i)=>{const s=++vi,u=v=>{v.data.uid===s&&v.data.postmate==="reply"&&(this.parent.removeEventListener("message",u,!1),v.data.error?i(v.data.error):r(v.data.value))};this.parent.addEventListener("message",u,!1),this.child.postMessage({postmate:"request",type:zt,property:t,args:n,uid:s},this.childOrigin)})}call(t,n){this.child.postMessage({postmate:"call",type:zt,property:t,data:n},this.childOrigin)}on(t,n){this.events[t]||(this.events[t]=[]),this.events[t].push(n)}destroy(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)}}class wi{constructor(t){it(this,"model",void 0),it(this,"parent",void 0),it(this,"parentOrigin",void 0),it(this,"child",void 0),this.model=t.model,this.parent=t.parent,this.parentOrigin=t.parentOrigin,this.child=t.child,this.child.addEventListener("message",n=>{if(!gn(n,this.parentOrigin))return;const{property:r,uid:i,data:s,args:u}=n.data;n.data.postmate!=="call"?((v,A,N)=>{const $=typeof v[A]=="function"?v[A].apply(null,N):v[A];return Promise.resolve($)})(this.model,r,u).then(v=>{n.source.postMessage({property:r,postmate:"reply",type:zt,uid:i,value:v},n.origin)}).catch(v=>{n.source.postMessage({property:r,postmate:"reply",type:zt,uid:i,error:v},n.origin)}):r in this.model&&typeof this.model[r]=="function"&&this.model[r](s)})}emit(t,n){this.parent.postMessage({postmate:"emit",type:zt,value:{name:t,data:n}},this.parentOrigin)}}class mn{constructor(t){it(this,"container",void 0),it(this,"parent",void 0),it(this,"frame",void 0),it(this,"child",void 0),it(this,"childOrigin",void 0),it(this,"url",void 0),it(this,"model",void 0),this.container=t.container,this.url=t.url,this.parent=window,this.frame=document.createElement("iframe"),t.id&&(this.frame.id=t.id),t.name&&(this.frame.name=t.name),t.allow&&(this.frame.allow=t.allow),this.frame.classList.add.apply(this.frame.classList,t.classListArray||[]),this.container.appendChild(this.frame),this.child=this.frame.contentWindow,this.model=t.model||{}}sendHandshake(t){const n=(s=>{const u=document.createElement("a");u.href=s;const v=u.protocol.length>4?u.protocol:window.location.protocol,A=u.host.length?u.port==="80"||u.port==="443"?u.hostname:u.host:window.location.host;return u.origin||`${v}//${A}`})(t=t||this.url);let r,i=0;return new Promise((s,u)=>{const v=N=>!!gn(N,n)&&(N.data.postmate==="handshake-reply"?(clearInterval(r),this.parent.removeEventListener("message",v,!1),this.childOrigin=N.origin,s(new _i(this))):u("Failed handshake"));this.parent.addEventListener("message",v,!1);const A=()=>{i++,this.child.postMessage({postmate:"handshake",type:zt,model:this.model},n),i===5&&clearInterval(r)};this.frame.addEventListener("load",()=>{A(),r=setInterval(A,500)}),this.frame.src=t})}destroy(){this.frame.parentNode.removeChild(this.frame)}}it(mn,"debug",!1),it(mn,"Model",void 0);class Ci{constructor(t){it(this,"child",void 0),it(this,"model",void 0),it(this,"parent",void 0),it(this,"parentOrigin",void 0),this.child=window,this.model=t,this.parent=this.child.parent}sendHandshakeReply(){return new Promise((t,n)=>{const r=i=>{if(i.data.postmate){if(i.data.postmate==="handshake"){this.child.removeEventListener("message",r,!1),i.source.postMessage({postmate:"handshake-reply",type:zt},i.origin),this.parentOrigin=i.origin;const s=i.data.model;return s&&Object.keys(s).forEach(u=>{this.model[u]=s[u]}),t(new wi(this))}return n("Handshake Reply Failed")}};this.child.addEventListener("message",r,!1)})}}function we(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{importHTML:Ei,createSandboxContainer:Si}=window.QSandbox||{};function ki(e,t){return e.startsWith("http")?fetch(e,t):(e=e.replace("file://",""),new Promise(async(n,r)=>{try{const i=await window.apis.doAction(["readFile",e]);n({text:()=>i})}catch(i){console.error(i),r(i)}}))}class xi extends Ue(){constructor(t){super(),we(this,"_pluginLocal",void 0),we(this,"_frame",void 0),we(this,"_root",void 0),we(this,"_loaded",!1),we(this,"_unmountFns",[]),this._pluginLocal=t,t._dispose(()=>{this._unmount()})}async load(){const{name:t,entry:n}=this._pluginLocal.options;if(this.loaded||!n)return;const{template:r,execScripts:i}=await Ei(n,{fetch:ki});this._mount(r,document.body);const s=Si(t,{elementGetter:()=>{var v;return(v=this._root)===null||v===void 0?void 0:v.firstChild}}).instance.proxy;s.__shadow_mode__=!0,s.LSPluginLocal=this._pluginLocal,s.LSPluginShadow=this,s.LSPluginUser=s.logseq=new Pn(this._pluginLocal.toJSON(),this._pluginLocal.caller);const u=await i(s,!0);this._unmountFns.push(u.unmount),this._loaded=!0}_mount(t,n){const r=this._frame=document.createElement("div");r.classList.add("lsp-shadow-sandbox"),r.id=this._pluginLocal.id,this._root=r.attachShadow({mode:"open"}),this._root.innerHTML=`<div>${t}</div>`,n.appendChild(r),this.emit("mounted")}_unmount(){for(const t of this._unmountFns)t&&t.call(null)}destroy(){var t,n;(t=this.frame)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.frame)}get loaded(){return this._loaded}get document(){var t;return(t=this._root)===null||t===void 0?void 0:t.firstChild}get frame(){return this._frame}}function Ot(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Bt=ur()("LSPlugin:caller"),Ce="#await#response#",Ai="#lspmsg#",dr="#lspmsg#error#",$e=e=>`#lspmsg#${e}`;class Ti extends Ue(){constructor(t){super(),Ot(this,"_pluginLocal",void 0),Ot(this,"_connected",!1),Ot(this,"_parent",void 0),Ot(this,"_child",void 0),Ot(this,"_shadow",void 0),Ot(this,"_status",void 0),Ot(this,"_userModel",{}),Ot(this,"_call",void 0),Ot(this,"_callUserModel",void 0),Ot(this,"_debugTag",""),this._pluginLocal=t,t&&(this._debugTag=t.debugTag)}async connectToChild(){if(this._connected)return;const{shadow:t}=this._pluginLocal;t?await this._setupShadowSandbox():await this._setupIframeSandbox()}async connectToParent(t={}){if(this._connected)return;const n=this,r=this._pluginLocal!=null;let i=0;const s=new Map,u=hn(6e4),v=this._extendUserModel({"#lspmsg#ready#":async $=>{v[$e($?.pid)]=({type:R,payload:H})=>{Bt(`[host (_call) -> *user] ${this._debugTag}`,R,H),n.emit(R,H)},await u.resolve()},"#lspmsg#beforeunload#":async $=>{const R=hn(1e4);n.emit("beforeunload",Object.assign({actor:R},$)),await R.promise},"#lspmsg#settings#":async({type:$,payload:R})=>{n.emit("settings:changed",R)},[Ai]:async({ns:$,type:R,payload:H})=>{Bt(`[host (async) -> *user] ${this._debugTag} ns=${$} type=${R}`,H),$&&$.startsWith("hook")?n.emit(`${$}:${R}`,H):n.emit(R,H)},"#lspmsg#reply#":({_sync:$,result:R})=>{if(Bt(`[sync host -> *user] #${$}`,R),s.has($)){const H=s.get($);H&&(R!=null&&R.hasOwnProperty(dr)?H.reject(R[dr]):H.resolve(R),s.delete($))}},...t});var A;if(r)return await u.promise,JSON.parse(JSON.stringify((A=this._pluginLocal)===null||A===void 0?void 0:A.toJSON()));const N=new Ci(v).sendHandshakeReply();return this._status="pending",await N.then($=>{this._child=$,this._connected=!0,this._call=async(R,H={},V)=>{if(V){const W=++i;s.set(W,V),H._sync=W,V.setTag(`async call #${W}`),Bt(`async call #${W}`)}return $.emit($e(v.baseInfo.id),{type:R,payload:H}),V?.promise},this._callUserModel=async(R,H)=>{try{v[R](H)}catch{Bt(`[model method] #${R} not existed`)}},setInterval(()=>{if(s.size>100)for(const[R,H]of s)H.settled&&s.delete(R)},18e5)}).finally(()=>{this._status=void 0}),await u.promise,v.baseInfo}async call(t,n={}){var r;return(r=this._call)===null||r===void 0?void 0:r.call(this,t,n)}async callAsync(t,n={}){var r;const i=hn(1e4);return(r=this._call)===null||r===void 0?void 0:r.call(this,t,n,i)}async callUserModel(t,...n){var r;return(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[t,...n])}async callUserModelAsync(t,...n){var r;return t=`${Ce}${t}`,(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[t,...n])}async _setupIframeSandbox(){const t=this._pluginLocal,n=t.id,r=`${n}_lsp_main`,i=new URL(t.options.entry);i.searchParams.set("__v__",t.options.version);const s=document.querySelector(`#${r}`);s&&s.parentElement.removeChild(s);const u=document.createElement("div");u.classList.add("lsp-iframe-sandbox-container"),u.id=r,u.dataset.pid=n;try{var v;const R=(v=await this._pluginLocal._loadLayoutsData())===null||v===void 0?void 0:v.$$0;if(R){u.dataset.inited_layout="true";let{width:H,height:V,left:W,top:K,vw:et,vh:st}=R;W=Math.max(W,0),W=typeof et=="number"?`${Math.min(100*W/et,99)}%`:`${W}px`,K=Math.max(K,45),K=typeof st=="number"?`${Math.min(100*K/st,99)}%`:`${K}px`,Object.assign(u.style,{width:H+"px",height:V+"px",left:W,top:K})}}catch(R){console.error("[Restore Layout Error]",R)}document.body.appendChild(u);const A=new mn({id:n+"_iframe",container:u,url:i.href,classListArray:["lsp-iframe-sandbox"],model:{baseInfo:JSON.parse(JSON.stringify(t.toJSON()))},allow:t.options.allow});let N,$=A.sendHandshake();return this._status="pending",new Promise((R,H)=>{N=setTimeout(()=>{H(new Error("handshake Timeout")),A.destroy()},8e3),$.then(V=>{this._parent=V,this._connected=!0,this.emit("connected"),V.on($e(t.id),({type:W,payload:K})=>{var et,st;Bt("[user -> *host] ",W,K),(et=this._pluginLocal)===null||et===void 0||et.emit(W,K||{}),(st=this._pluginLocal)===null||st===void 0||st.caller.emit(W,K||{})}),this._call=async(...W)=>{V.call($e(t.id),{type:W[0],payload:Object.assign(W[1]||{},{$$pid:t.id})})},this._callUserModel=async(W,...K)=>{if(W.startsWith(Ce))return await V.get(W.replace(Ce,""),...K);V.call(W,K?.[0])},R(null)}).catch(V=>{H(V)}).finally(()=>{clearTimeout(N)})}).catch(R=>{throw Bt("[iframe sandbox] error",R),R}).finally(()=>{this._status=void 0})}async _setupShadowSandbox(){const t=this._pluginLocal,n=this._shadow=new xi(t);try{this._status="pending",await n.load(),this._connected=!0,this.emit("connected"),this._call=async(r,i={},s)=>{var u;return s&&(i.actor=s),(u=this._pluginLocal)===null||u===void 0||u.emit(r,Object.assign(i,{$$pid:t.id})),s?.promise},this._callUserModel=async(...r)=>{var i;let s=r[0];(i=s)!==null&&i!==void 0&&i.startsWith(Ce)&&(s=s.replace(Ce,""));const u=r[1]||{},v=this._userModel[s];typeof v=="function"&&await v.call(null,u)}}catch(r){throw Bt("[shadow sandbox] error",r),r}finally{this._status=void 0}}_extendUserModel(t){return Object.assign(this._userModel,t)}_getSandboxIframeContainer(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxShadowContainer(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame.parentNode}_getSandboxIframeRoot(){var t;return(t=this._parent)===null||t===void 0?void 0:t.frame}_getSandboxShadowRoot(){var t;return(t=this._shadow)===null||t===void 0?void 0:t.frame}set debugTag(t){this._debugTag=t}async destroy(){var t;let n=null;this._parent&&(n=this._getSandboxIframeContainer(),await this._parent.destroy()),this._shadow&&(n=this._getSandboxShadowContainer(),this._shadow.destroy()),(t=n)===null||t===void 0||t.parentNode.removeChild(n)}}function fr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class pr{constructor(t,n){fr(this,"ctx",void 0),fr(this,"opts",void 0),this.ctx=t,this.opts=n}get ctxId(){return this.ctx.baseInfo.id}setItem(t,n){var r;return this.ctx.caller.callAsync("api:call",{method:"write-plugin-storage-file",args:[this.ctxId,t,n,(r=this.opts)===null||r===void 0?void 0:r.assets]})}getItem(t){var n;return this.ctx.caller.callAsync("api:call",{method:"read-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}removeItem(t){var n;return this.ctx.caller.call("api:call",{method:"unlink-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}allKeys(){var t;return this.ctx.caller.callAsync("api:call",{method:"list-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}clear(){var t;return this.ctx.caller.call("api:call",{method:"clear-plugin-storage-files",args:[this.ctxId,(t=this.opts)===null||t===void 0?void 0:t.assets]})}hasItem(t){var n;return this.ctx.caller.callAsync("api:call",{method:"exist-plugin-storage-file",args:[this.ctxId,t,(n=this.opts)===null||n===void 0?void 0:n.assets]})}}class Oi{constructor(t){var n,r,i;i=void 0,(r="ctx")in(n=this)?Object.defineProperty(n,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[r]=i,this.ctx=t}get React(){return this.ensureHostScope().React}get ReactDOM(){return this.ensureHostScope().ReactDOM}get Components(){return{Editor:this.ensureHostScope().logseq.sdk.experiments.cp_page_editor}}get Utils(){const t=this.ensureHostScope().logseq.sdk.utils,n=r=>t[ae(r)];return{toClj:n("toClj"),jsxToClj:n("jsxToClj"),toJs:n("toJs"),toKeyword:n("toKeyword"),toSymbol:n("toSymbol")}}get pluginLocal(){return this.ensureHostScope().LSPluginCore.ensurePlugin(this.ctx.baseInfo.id)}invokeExperMethod(t,...n){var r;const i=this.ensureHostScope();t=(r=ae(t))===null||r===void 0?void 0:r.toLowerCase();const s=i.logseq.api["exper_"+t]||i.logseq.sdk.experiments[t];return s?.apply(i,n)}async loadScripts(...t){(t=t.map(n=>n!=null&&n.startsWith("http")?n:this.ctx.resolveResourceFullUrl(n))).unshift(this.ctx.baseInfo.id),await this.invokeExperMethod("loadScripts",...t)}registerFencedCodeRenderer(t,n){return this.invokeExperMethod("registerFencedCodeRenderer",this.ctx.baseInfo.id,t,n)}registerDaemonRenderer(t,n){return this.invokeExperMethod("registerDaemonRenderer",this.ctx.baseInfo.id,t,n)}registerRouteRenderer(t,n){return this.invokeExperMethod("registerRouteRenderer",this.ctx.baseInfo.id,t,n)}registerExtensionsEnhancer(t,n){const r=this.ensureHostScope();return t==="katex"&&r.katex&&n(r.katex).catch(console.error),this.invokeExperMethod("registerExtensionsEnhancer",this.ctx.baseInfo.id,t,n)}ensureHostScope(){try{var t;(t=window.top)===null||t===void 0||t.document}catch{console.error("Can not access host scope!")}return window.top}}function se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const hr=e=>`task_callback_${e}`;class Ii{constructor(t,n,r={}){se(this,"_client",void 0),se(this,"_requestId",void 0),se(this,"_requestOptions",void 0),se(this,"_promise",void 0),se(this,"_aborted",!1),this._client=t,this._requestId=n,this._requestOptions=r,this._promise=new Promise((v,A)=>{if(!this._requestId)return A(null);this._client.once(hr(this._requestId),N=>{N&&N instanceof Error?A(N):v(N)})});const{success:i,fail:s,final:u}=this._requestOptions;this._promise.then(v=>{i?.(v)}).catch(v=>{s?.(v)}).finally(()=>{u?.()})}abort(){this._requestOptions.abortable&&!this._aborted&&(this._client.ctx._execCallableAPI("http_request_abort",this._requestId),this._aborted=!0)}get promise(){return this._promise}get client(){return this._client}get requestId(){return this._requestId}}class yn extends lr.EventEmitter{constructor(t){super(),se(this,"_ctx",void 0),this._ctx=t,this.ctx.caller.on("#lsp#request#callback",n=>{const r=n?.requestId;r&&this.emit(hr(r),n?.payload)})}static createRequestTask(t,n,r){return new Ii(t,n,r)}async _request(t){const n=this.ctx.baseInfo.id,{success:r,fail:i,final:s,...u}=t,v=this.ctx.Experiments.invokeExperMethod("request",n,u),A=yn.createRequestTask(this.ctx.Request,v,t);return u.abortable?A:A.promise}get ctx(){return this._ctx}}const It=Array.isArray,gr=typeof Pe=="object"&&Pe&&Pe.Object===Object&&Pe;var ji=typeof self=="object"&&self&&self.Object===Object&&self;const Lt=gr||ji||Function("return this")(),Ht=Lt.Symbol;var mr=Object.prototype,Mi=mr.hasOwnProperty,Pi=mr.toString,Ee=Ht?Ht.toStringTag:void 0;const Di=function(e){var t=Mi.call(e,Ee),n=e[Ee];try{e[Ee]=void 0;var r=!0}catch{}var i=Pi.call(e);return r&&(t?e[Ee]=n:delete e[Ee]),i};var Li=Object.prototype.toString;const Fi=function(e){return Li.call(e)};var yr=Ht?Ht.toStringTag:void 0;const le=function(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":yr&&yr in Object(e)?Di(e):Fi(e)},vn=function(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")},bn=function(e){if(!vn(e))return!1;var t=le(e);return t=="[object Function]"||t=="[object GeneratorFunction]"||t=="[object AsyncFunction]"||t=="[object Proxy]"},_n=Lt["__core-js_shared__"];var vr,br=(vr=/[^.]+$/.exec(_n&&_n.keys&&_n.keys.IE_PROTO||""))?"Symbol(src)_1."+vr:"";const Ni=function(e){return!!br&&br in e};var Ri=Function.prototype.toString;const Vt=function(e){if(e!=null){try{return Ri.call(e)}catch{}try{return e+""}catch{}}return""};var Ui=/^\[object .+?Constructor\]$/,$i=Function.prototype,qi=Object.prototype,zi=$i.toString,Bi=qi.hasOwnProperty,Hi=RegExp("^"+zi.call(Bi).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Wi=function(e){return!(!vn(e)||Ni(e))&&(bn(e)?Hi:Ui).test(Vt(e))},Gi=function(e,t){return e?.[t]},Kt=function(e,t){var n=Gi(e,t);return Wi(n)?n:void 0},_r=function(){try{var e=Kt(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Yi=function(e,t,n){t=="__proto__"&&_r?_r(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},Ji=function(e){return function(t,n,r){for(var i=-1,s=Object(t),u=r(t),v=u.length;v--;){var A=u[++i];if(n(s[A],A,s)===!1)break}return t}}(),Zi=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},ce=function(e){return e!=null&&typeof e=="object"},wr=function(e){return ce(e)&&le(e)=="[object Arguments]"};var Cr=Object.prototype,Vi=Cr.hasOwnProperty,Ki=Cr.propertyIsEnumerable;const Er=wr(function(){return arguments}())?wr:function(e){return ce(e)&&Vi.call(e,"callee")&&!Ki.call(e,"callee")},Xi=function(){return!1};var Sr=m&&!m.nodeType&&m,kr=Sr&&!0&&c&&!c.nodeType&&c,xr=kr&&kr.exports===Sr?Lt.Buffer:void 0;const wn=(xr?xr.isBuffer:void 0)||Xi;var Qi=/^(?:0|[1-9]\d*)$/;const Ar=function(e,t){var n=typeof e;return!!(t=t??9007199254740991)&&(n=="number"||n!="symbol"&&Qi.test(e))&&e>-1&&e%1==0&&e<t},Cn=function(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=9007199254740991};var ot={};ot["[object Float32Array]"]=ot["[object Float64Array]"]=ot["[object Int8Array]"]=ot["[object Int16Array]"]=ot["[object Int32Array]"]=ot["[object Uint8Array]"]=ot["[object Uint8ClampedArray]"]=ot["[object Uint16Array]"]=ot["[object Uint32Array]"]=!0,ot["[object Arguments]"]=ot["[object Array]"]=ot["[object ArrayBuffer]"]=ot["[object Boolean]"]=ot["[object DataView]"]=ot["[object Date]"]=ot["[object Error]"]=ot["[object Function]"]=ot["[object Map]"]=ot["[object Number]"]=ot["[object Object]"]=ot["[object RegExp]"]=ot["[object Set]"]=ot["[object String]"]=ot["[object WeakMap]"]=!1;const ta=function(e){return ce(e)&&Cn(e.length)&&!!ot[le(e)]},ea=function(e){return function(t){return e(t)}};var Tr=m&&!m.nodeType&&m,Se=Tr&&!0&&c&&!c.nodeType&&c,En=Se&&Se.exports===Tr&&gr.process,Or=function(){try{var e=Se&&Se.require&&Se.require("util").types;return e||En&&En.binding&&En.binding("util")}catch{}}(),Ir=Or&&Or.isTypedArray;const jr=Ir?ea(Ir):ta;var na=Object.prototype.hasOwnProperty;const ra=function(e,t){var n=It(e),r=!n&&Er(e),i=!n&&!r&&wn(e),s=!n&&!r&&!i&&jr(e),u=n||r||i||s,v=u?Zi(e.length,String):[],A=v.length;for(var N in e)!na.call(e,N)||u&&(N=="length"||i&&(N=="offset"||N=="parent")||s&&(N=="buffer"||N=="byteLength"||N=="byteOffset")||Ar(N,A))||v.push(N);return v};var oa=Object.prototype;const ia=function(e){var t=e&&e.constructor;return e===(typeof t=="function"&&t.prototype||oa)},aa=function(e,t){return function(n){return e(t(n))}}(Object.keys,Object);var sa=Object.prototype.hasOwnProperty;const la=function(e){if(!ia(e))return aa(e);var t=[];for(var n in Object(e))sa.call(e,n)&&n!="constructor"&&t.push(n);return t},ca=function(e){return e!=null&&Cn(e.length)&&!bn(e)},Sn=function(e){return ca(e)?ra(e):la(e)},ua=function(e,t){return e&&Ji(e,t,Sn)},da=function(){this.__data__=[],this.size=0},Mr=function(e,t){return e===t||e!=e&&t!=t},qe=function(e,t){for(var n=e.length;n--;)if(Mr(e[n][0],t))return n;return-1};var fa=Array.prototype.splice;const pa=function(e){var t=this.__data__,n=qe(t,e);return!(n<0)&&(n==t.length-1?t.pop():fa.call(t,n,1),--this.size,!0)},ha=function(e){var t=this.__data__,n=qe(t,e);return n<0?void 0:t[n][1]},ga=function(e){return qe(this.__data__,e)>-1},ma=function(e,t){var n=this.__data__,r=qe(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function ue(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ue.prototype.clear=da,ue.prototype.delete=pa,ue.prototype.get=ha,ue.prototype.has=ga,ue.prototype.set=ma;const ze=ue,ya=function(){this.__data__=new ze,this.size=0},va=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},ba=function(e){return this.__data__.get(e)},_a=function(e){return this.__data__.has(e)},ke=Kt(Lt,"Map"),xe=Kt(Object,"create"),wa=function(){this.__data__=xe?xe(null):{},this.size=0},Ca=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var Ea=Object.prototype.hasOwnProperty;const Sa=function(e){var t=this.__data__;if(xe){var n=t[e];return n==="__lodash_hash_undefined__"?void 0:n}return Ea.call(t,e)?t[e]:void 0};var ka=Object.prototype.hasOwnProperty;const xa=function(e){var t=this.__data__;return xe?t[e]!==void 0:ka.call(t,e)},Aa=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=xe&&t===void 0?"__lodash_hash_undefined__":t,this};function de(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}de.prototype.clear=wa,de.prototype.delete=Ca,de.prototype.get=Sa,de.prototype.has=xa,de.prototype.set=Aa;const Pr=de,Ta=function(){this.size=0,this.__data__={hash:new Pr,map:new(ke||ze),string:new Pr}},Oa=function(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null},Be=function(e,t){var n=e.__data__;return Oa(t)?n[typeof t=="string"?"string":"hash"]:n.map},Ia=function(e){var t=Be(this,e).delete(e);return this.size-=t?1:0,t},ja=function(e){return Be(this,e).get(e)},Ma=function(e){return Be(this,e).has(e)},Pa=function(e,t){var n=Be(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function fe(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}fe.prototype.clear=Ta,fe.prototype.delete=Ia,fe.prototype.get=ja,fe.prototype.has=Ma,fe.prototype.set=Pa;const He=fe,Da=function(e,t){var n=this.__data__;if(n instanceof ze){var r=n.__data__;if(!ke||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new He(r)}return n.set(e,t),this.size=n.size,this};function pe(e){var t=this.__data__=new ze(e);this.size=t.size}pe.prototype.clear=ya,pe.prototype.delete=va,pe.prototype.get=ba,pe.prototype.has=_a,pe.prototype.set=Da;const We=pe,La=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Fa=function(e){return this.__data__.has(e)};function Ge(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new He;++t<n;)this.add(e[t])}Ge.prototype.add=Ge.prototype.push=La,Ge.prototype.has=Fa;const Na=Ge,Ra=function(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},Ua=function(e,t){return e.has(t)},Dr=function(e,t,n,r,i,s){var u=1&n,v=e.length,A=t.length;if(v!=A&&!(u&&A>v))return!1;var N=s.get(e),$=s.get(t);if(N&&$)return N==t&&$==e;var R=-1,H=!0,V=2&n?new Na:void 0;for(s.set(e,t),s.set(t,e);++R<v;){var W=e[R],K=t[R];if(r)var et=u?r(K,W,R,t,e,s):r(W,K,R,e,t,s);if(et!==void 0){if(et)continue;H=!1;break}if(V){if(!Ra(t,function(st,Ct){if(!Ua(V,Ct)&&(W===st||i(W,st,n,r,s)))return V.push(Ct)})){H=!1;break}}else if(W!==K&&!i(W,K,n,r,s)){H=!1;break}}return s.delete(e),s.delete(t),H},Lr=Lt.Uint8Array,$a=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n},qa=function(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n};var Fr=Ht?Ht.prototype:void 0,kn=Fr?Fr.valueOf:void 0;const za=function(e,t,n,r,i,s,u){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!s(new Lr(e),new Lr(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Mr(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var v=$a;case"[object Set]":var A=1&r;if(v||(v=qa),e.size!=t.size&&!A)return!1;var N=u.get(e);if(N)return N==t;r|=2,u.set(e,t);var $=Dr(v(e),v(t),r,i,s,u);return u.delete(e),$;case"[object Symbol]":if(kn)return kn.call(e)==kn.call(t)}return!1},Ba=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},Ha=function(e,t,n){var r=t(e);return It(e)?r:Ba(r,n(e))},Wa=function(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var u=e[n];t(u,n,e)&&(s[i++]=u)}return s},Ga=function(){return[]};var Ya=Object.prototype.propertyIsEnumerable,Nr=Object.getOwnPropertySymbols;const Ja=Nr?function(e){return e==null?[]:(e=Object(e),Wa(Nr(e),function(t){return Ya.call(e,t)}))}:Ga,Rr=function(e){return Ha(e,Sn,Ja)};var Za=Object.prototype.hasOwnProperty;const Va=function(e,t,n,r,i,s){var u=1&n,v=Rr(e),A=v.length;if(A!=Rr(t).length&&!u)return!1;for(var N=A;N--;){var $=v[N];if(!(u?$ in t:Za.call(t,$)))return!1}var R=s.get(e),H=s.get(t);if(R&&H)return R==t&&H==e;var V=!0;s.set(e,t),s.set(t,e);for(var W=u;++N<A;){var K=e[$=v[N]],et=t[$];if(r)var st=u?r(et,K,$,t,e,s):r(K,et,$,e,t,s);if(!(st===void 0?K===et||i(K,et,n,r,s):st)){V=!1;break}W||(W=$=="constructor")}if(V&&!W){var Ct=e.constructor,Ft=t.constructor;Ct==Ft||!("constructor"in e)||!("constructor"in t)||typeof Ct=="function"&&Ct instanceof Ct&&typeof Ft=="function"&&Ft instanceof Ft||(V=!1)}return s.delete(e),s.delete(t),V},xn=Kt(Lt,"DataView"),An=Kt(Lt,"Promise"),Tn=Kt(Lt,"Set"),On=Kt(Lt,"WeakMap");var Ur="[object Map]",$r="[object Promise]",qr="[object Set]",zr="[object WeakMap]",Br="[object DataView]",Ka=Vt(xn),Xa=Vt(ke),Qa=Vt(An),ts=Vt(Tn),es=Vt(On),Xt=le;(xn&&Xt(new xn(new ArrayBuffer(1)))!=Br||ke&&Xt(new ke)!=Ur||An&&Xt(An.resolve())!=$r||Tn&&Xt(new Tn)!=qr||On&&Xt(new On)!=zr)&&(Xt=function(e){var t=le(e),n=t=="[object Object]"?e.constructor:void 0,r=n?Vt(n):"";if(r)switch(r){case Ka:return Br;case Xa:return Ur;case Qa:return $r;case ts:return qr;case es:return zr}return t});const Hr=Xt;var Wr="[object Arguments]",Gr="[object Array]",Ye="[object Object]",Yr=Object.prototype.hasOwnProperty;const ns=function(e,t,n,r,i,s){var u=It(e),v=It(t),A=u?Gr:Hr(e),N=v?Gr:Hr(t),$=(A=A==Wr?Ye:A)==Ye,R=(N=N==Wr?Ye:N)==Ye,H=A==N;if(H&&wn(e)){if(!wn(t))return!1;u=!0,$=!1}if(H&&!$)return s||(s=new We),u||jr(e)?Dr(e,t,n,r,i,s):za(e,t,A,n,r,i,s);if(!(1&n)){var V=$&&Yr.call(e,"__wrapped__"),W=R&&Yr.call(t,"__wrapped__");if(V||W){var K=V?e.value():e,et=W?t.value():t;return s||(s=new We),i(K,et,n,r,s)}}return!!H&&(s||(s=new We),Va(e,t,n,r,i,s))},Jr=function e(t,n,r,i,s){return t===n||(t==null||n==null||!ce(t)&&!ce(n)?t!=t&&n!=n:ns(t,n,r,i,e,s))},rs=function(e,t,n,r){var i=n.length,s=i;if(e==null)return!s;for(e=Object(e);i--;){var u=n[i];if(u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++i<s;){var v=(u=n[i])[0],A=e[v],N=u[1];if(u[2]){if(A===void 0&&!(v in e))return!1}else{var $=new We,R;if(!(R===void 0?Jr(N,A,3,r,$):R))return!1}}return!0},Zr=function(e){return e==e&&!vn(e)},os=function(e){for(var t=Sn(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Zr(i)]}return t},Vr=function(e,t){return function(n){return n!=null&&n[e]===t&&(t!==void 0||e in Object(n))}},is=function(e){var t=os(e);return t.length==1&&t[0][2]?Vr(t[0][0],t[0][1]):function(n){return n===e||rs(n,e,t)}},In=function(e){return typeof e=="symbol"||ce(e)&&le(e)=="[object Symbol]"};var as=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ss=/^\w*$/;const jn=function(e,t){if(It(e))return!1;var n=typeof e;return!(n!="number"&&n!="symbol"&&n!="boolean"&&e!=null&&!In(e))||ss.test(e)||!as.test(e)||t!=null&&e in Object(t)};function Mn(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError("Expected a function");var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var u=e.apply(this,r);return n.cache=s.set(i,u)||s,u};return n.cache=new(Mn.Cache||He),n}Mn.Cache=He;const ls=Mn;var cs=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,us=/\\(\\)?/g;const ds=function(e){var t=ls(e,function(r){return n.size===500&&n.clear(),r}),n=t.cache;return t}(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(cs,function(n,r,i,s){t.push(i?s.replace(us,"$1"):r||n)}),t}),fs=function(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};var Kr=Ht?Ht.prototype:void 0,Xr=Kr?Kr.toString:void 0;const ps=function e(t){if(typeof t=="string")return t;if(It(t))return fs(t,e)+"";if(In(t))return Xr?Xr.call(t):"";var n=t+"";return n=="0"&&1/t==-1/0?"-0":n},hs=function(e){return e==null?"":ps(e)},Qr=function(e,t){return It(e)?e:jn(e,t)?[e]:ds(hs(e))},Je=function(e){if(typeof e=="string"||In(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t},to=function(e,t){for(var n=0,r=(t=Qr(t,e)).length;e!=null&&n<r;)e=e[Je(t[n++])];return n&&n==r?e:void 0},gs=function(e,t,n){var r=e==null?void 0:to(e,t);return r===void 0?n:r},ms=function(e,t){return e!=null&&t in Object(e)},ys=function(e,t,n){for(var r=-1,i=(t=Qr(t,e)).length,s=!1;++r<i;){var u=Je(t[r]);if(!(s=e!=null&&n(e,u)))break;e=e[u]}return s||++r!=i?s:!!(i=e==null?0:e.length)&&Cn(i)&&Ar(u,i)&&(It(e)||Er(e))},vs=function(e,t){return e!=null&&ys(e,t,ms)},bs=function(e,t){return jn(e)&&Zr(t)?Vr(Je(e),t):function(n){var r=gs(n,e);return r===void 0&&r===t?vs(n,e):Jr(t,r,3)}},_s=function(e){return e},ws=function(e){return function(t){return t?.[e]}},Cs=function(e){return function(t){return to(t,e)}},Es=function(e){return jn(e)?ws(Je(e)):Cs(e)},Ss=function(e){return typeof e=="function"?e:e==null?_s:typeof e=="object"?It(e)?bs(e[0],e[1]):is(e):Es(e)},ks=function(e,t){var n={};return t=Ss(t),ua(e,function(r,i,s){Yi(n,t(r,i,s),r)}),n};function eo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class xs{constructor(t,n){eo(this,"ctx",void 0),eo(this,"serviceHooks",void 0),this.ctx=t,this.serviceHooks=n,t._execCallableAPI("register-search-service",t.baseInfo.id,n.name,n.options),Object.entries({query:{f:"onQuery",args:["graph","q",!0],reply:!0,transformOutput:r=>(It(r?.blocks)&&(r.blocks=r.blocks.map(i=>i&&ks(i,(s,u)=>`block/${u}`))),r)},rebuildBlocksIndice:{f:"onIndiceInit",args:["graph","blocks"]},transactBlocks:{f:"onBlocksChanged",args:["graph","data"]},truncateBlocks:{f:"onIndiceReset",args:["graph"]},removeDb:{f:"onGraph",args:["graph"]}}).forEach(([r,i])=>{const s=(u=>`service:search:${u}:${n.name}`)(r);t.caller.on(s,async u=>{if(bn(n?.[i.f])){let v=null;try{v=await n[i.f].apply(n,(i.args||[]).map(A=>{if(u){if(A===!0)return u;if(u.hasOwnProperty(A)){const N=u[A];return delete u[A],N}}})),i.transformOutput&&(v=i.transformOutput(v))}catch(A){console.error("[SearchService] ",A),v=A}finally{i.reply&&t.caller.call(`${s}:reply`,v)}}})})}}function Ae(e,t,n){(function(r,i){if(i.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function At(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Te(e,t,n){return function(r,i,s){if(i.set)i.set.call(r,s);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=s}}(e,no(e,t,"set"),n),n}function jt(e,t){return function(n,r){return r.get?r.get.call(n):r.value}(e,no(e,t,"get"))}function no(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}const As=Symbol.for("proxy-continue"),Ts=ur()("LSPlugin:user"),ro=new hi("",{console:!0});function he(e,t,n){var r;const{key:i,label:s,desc:u,palette:v,keybinding:A,extras:N}=t;if(typeof n!="function")return this.logger.error(`${i||s}: command action should be function.`),!1;const $=function(H){if(typeof H=="string")return H.trim().replace(/\s/g,"_").toLowerCase()}(i);if(!$)return this.logger.error(`${s}: command key is required.`),!1;const R=`SimpleCommandHook${$}${++ao}`;this.Editor["on"+R](n),(r=this.caller)===null||r===void 0||r.call("api:call",{method:"register-plugin-simple-command",args:[this.baseInfo.id,[{key:$,label:s,type:e,desc:u,keybinding:A,extras:N},["editor/hook",R]],v]})}function oo(e){return!(typeof(t=e)!="string"||t.length!==36||!/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(t))||(ro.error(`#${e} is not a valid UUID string.`),!1);var t}let Ze=null,io=new Map;const Os={async getInfo(e){return Ze||(Ze=await this._execCallableAPIAsync("get-app-info")),typeof e=="string"?Ze[e]:Ze},registerCommand:he,registerSearchService(e){if(io.has(e.name))throw new Error(`SearchService: #${e.name} has registered!`);io.set(e.name,new xs(this,e))},registerCommandPalette(e,t){const{key:n,label:r,keybinding:i}=e;return he.call(this,"$palette$",{key:n,label:r,palette:!0,keybinding:i},t)},registerCommandShortcut(e,t,n={}){typeof e=="string"&&(e={mode:"global",binding:e});const{binding:r}=e,i="$shortcut$",s=n.key||i+ae(r?.toString());return he.call(this,i,{...n,key:s,palette:!1,keybinding:e},t)},registerUIItem(e,t){var n;const r=this.baseInfo.id;(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-ui-item",args:[r,e,t]})},registerPageMenuItem(e,t){if(typeof t!="function")return!1;const n=e+"_"+this.baseInfo.id,r=e;he.call(this,"page-menu-item",{key:n,label:r},t)},onBlockRendererSlotted(e,t){if(!oo(e))return;const n=this.baseInfo.id,r=`hook:editor:${ae(`slot:${e}`)}`;return this.caller.on(r,t),this.App._installPluginHook(n,r),()=>{this.caller.off(r,t),this.App._uninstallPluginHook(n,r)}},invokeExternalPlugin(e,...t){var n;if(!(e=(n=e)===null||n===void 0?void 0:n.trim()))return;let[r,i]=e.split(".");if(!["models","commands"].includes(i?.toLowerCase()))throw new Error("Type only support '.models' or '.commands' currently.");const s=e.replace(`${r}.${i}.`,"");if(!r||!i||!s)throw new Error(`Illegal type of #${e} to invoke external plugin.`);return this._execCallableAPIAsync("invoke_external_plugin_cmd",r,i.toLowerCase(),s,t)},setFullScreen(e){const t=(...n)=>this._callWin("setFullScreen",...n);e==="toggle"?this._callWin("isFullScreen").then(n=>{n?t():t(!0)}):e?t(!0):t()}};let ao=0;const Is={newBlockUUID(){return this._execCallableAPIAsync("new_block_uuid")},isPageBlock:e=>e.uuid&&e.hasOwnProperty("name"),registerSlashCommand(e,t){var n;Ts("Register slash command #",this.baseInfo.id,e,t),typeof t=="function"&&(t=[["editor/clear-current-slash",!1],["editor/restore-saved-cursor"],["editor/hook",t]]),t=t.map(r=>{const[i,...s]=r;if(i==="editor/hook"){let u=s[0],v=()=>{var N;(N=this.caller)===null||N===void 0||N.callUserModel(u)};typeof u=="function"&&(v=u);const A=`SlashCommandHook${i}${++ao}`;r[1]=A,this.Editor["on"+A](v)}return r}),(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-slash-command",args:[this.baseInfo.id,[e,t]]})},registerBlockContextMenuItem(e,t){if(typeof t!="function")return!1;const n=e+"_"+this.baseInfo.id;he.call(this,"block-context-menu-item",{key:n,label:e},t)},registerHighlightContextMenuItem(e,t,n){if(typeof t!="function")return!1;const r=e+"_"+this.baseInfo.id;he.call(this,"highlight-context-menu-item",{key:r,label:e,extras:n},t)},scrollToBlockInPage(e,t,n){const r="block-content-"+t;n!=null&&n.replaceState?this.App.replaceState("page",{name:e},{anchor:r}):this.App.pushState("page",{name:e},{anchor:r})}},js={onBlockChanged(e,t){if(!oo(e))return;const n=this.baseInfo.id,r=`hook:db:${ae(`block:${e}`)}`,i=({block:s,txData:u,txMeta:v})=>{s.uuid===e&&t(s,u,v)};return this.caller.on(r,i),this.App._installPluginHook(n,r),()=>{this.caller.off(r,i),this.App._uninstallPluginHook(n,r)}},datascriptQuery(e,...t){return t.pop(),t!=null&&t.some(n=>typeof n=="function")?this.Experiments.ensureHostScope().logseq.api.datascript_query(e,...t):this._execCallableAPIAsync("datascript_query",e,...t)}},Ms={},Ps={},Ds={},Ls={makeSandboxStorage(){return new pr(this,{assets:!0})}};var Ve=new WeakMap,Ke=new WeakMap,Xe=new WeakMap,Qe=new WeakMap,tn=new WeakMap;class Pn extends Ue(){constructor(t,n){super(),At(this,"_baseInfo",void 0),At(this,"_caller",void 0),At(this,"_version","0.2.12"),At(this,"_debugTag",""),At(this,"_settingsSchema",void 0),At(this,"_connected",!1),At(this,"_ui",new Map),At(this,"_mFileStorage",void 0),At(this,"_mRequest",void 0),At(this,"_mExperiments",void 0),At(this,"_beforeunloadCallback",void 0),Ae(this,Ve,{writable:!0,value:void 0}),Ae(this,Ke,{writable:!0,value:void 0}),Ae(this,Xe,{writable:!0,value:void 0}),Ae(this,Qe,{writable:!0,value:void 0}),Ae(this,tn,{writable:!0,value:void 0}),this._baseInfo=t,this._caller=n,n.on("sys:ui:visible",r=>{r!=null&&r.toggle&&this.toggleMainUI()}),n.on("settings:changed",r=>{const i=Object.assign({},this.settings),s=Object.assign(this._baseInfo.settings,r);this.emit("settings:changed",{...s},i)}),n.on("beforeunload",async r=>{const{actor:i,...s}=r,u=this._beforeunloadCallback;try{u&&await u(s),i?.resolve(null)}catch(v){this.logger.error("[beforeunload] ",v),i?.reject(v)}})}async ready(t,n){var r,i;if(!this._connected)try{var s;typeof t=="function"&&(n=t,t={});let u=await this._caller.connectToParent(t);this._connected=!0,r=this._baseInfo,i=u,u=ci()(r,i,{arrayMerge:(v,A)=>A}),this._baseInfo=u,(s=u)!==null&&s!==void 0&&s.id&&(this._debugTag=this._caller.debugTag=`#${u.id} [${u.name}]`,this.logger.setTag(this._debugTag)),this._settingsSchema&&(u.settings=function(v,A){const N=(A||[]).reduce(($,R)=>("default"in R&&($[R.key]=R.default),$),{});return Object.assign(N,v)}(u.settings,this._settingsSchema),await this.useSettingsSchema(this._settingsSchema));try{await this._execCallableAPIAsync("setSDKMetadata",{version:this._version,runtime:"js"})}catch(v){console.warn(v)}n&&n.call(this,u)}catch(u){console.error(`${this._debugTag} [Ready Error]`,u)}}ensureConnected(){if(!this._connected)throw new Error("not connected")}beforeunload(t){typeof t=="function"&&(this._beforeunloadCallback=t)}provideModel(t){return this.caller._extendUserModel(t),this}provideTheme(t){return this.caller.call("provider:theme",t),this}provideStyle(t){return this.caller.call("provider:style",t),this}provideUI(t){return this.caller.call("provider:ui",t),this}useSettingsSchema(t){return this.connected&&this.caller.call("settings:schema",{schema:t,isSync:!0}),this._settingsSchema=t,this}updateSettings(t){this.caller.call("settings:update",t)}onSettingsChanged(t){const n="settings:changed";return this.on(n,t),()=>this.off(n,t)}showSettingsUI(){this.caller.call("settings:visible:changed",{visible:!0})}hideSettingsUI(){this.caller.call("settings:visible:changed",{visible:!1})}setMainUIAttrs(t){this.caller.call("main-ui:attrs",t)}setMainUIInlineStyle(t){this.caller.call("main-ui:style",t)}hideMainUI(t){const n={key:0,visible:!1,cursor:t?.restoreEditingCursor};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}showMainUI(t){const n={key:0,visible:!0,autoFocus:t?.autoFocus};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}toggleMainUI(){const n=this._ui.get(0);n&&n.visible?this.hideMainUI():this.showMainUI()}get version(){return this._version}get isMainUIVisible(){const t=this._ui.get(0);return!!(t&&t.visible)}get connected(){return this._connected}get baseInfo(){return this._baseInfo}get effect(){return(t=this)&&(((n=t.baseInfo)===null||n===void 0?void 0:n.effect)||!((r=t.baseInfo)!==null&&r!==void 0&&r.iir));var t,n,r}get logger(){return ro}get settings(){var t;return(t=this.baseInfo)===null||t===void 0?void 0:t.settings}get caller(){return this._caller}resolveResourceFullUrl(t){if(this.ensureConnected(),t)return t=t.replace(/^[.\\/]+/,""),gi(this._baseInfo.lsr,t)}_makeUserProxy(t,n){const r=this,i=this.caller;return new Proxy(t,{get(s,u,v){const A=s[u];return function(...N){if(A){N?.length!==0&&N.concat(n);const R=A.apply(r,N);if(R!==As)return R}if(n){const R=u.toString().match(/^(once|off|on)/i);if(R!=null){const H=R[0].toLowerCase(),V=R.input,W=H==="off",K=r.baseInfo.id;let et=V.slice(H.length),st=N[0],Ct=N[1];typeof st=="string"&&typeof Ct=="function"&&(st=st.replace(/^logseq./,":"),et=`${et}${st}`,st=Ct,Ct=N[2]),et=`hook:${n}:${ae(et)}`,i[H](et,st);const Ft=()=>{i.off(et,st),i.listenerCount(et)||r.App._uninstallPluginHook(K,et)};return W?void Ft():(r.App._installPluginHook(K,et,Ct),Ft)}}let $=u;return["git","ui","assets","utils"].includes(n)&&($=n+"_"+$),i.callAsync("api:call",{tag:n,method:$,args:N})}}})}_execCallableAPIAsync(t,...n){return this._caller.callAsync("api:call",{method:t,args:n})}_execCallableAPI(t,...n){this._caller.call("api:call",{method:t,args:n})}_callWin(...t){return this._execCallableAPIAsync("_callMainWin",...t)}get App(){return jt(this,Ve)?jt(this,Ve):Te(this,Ve,this._makeUserProxy(Os,"app"))}get Editor(){return jt(this,Ke)?jt(this,Ke):Te(this,Ke,this._makeUserProxy(Is,"editor"))}get DB(){return jt(this,Xe)?jt(this,Xe):Te(this,Xe,this._makeUserProxy(js,"db"))}get UI(){return jt(this,Qe)?jt(this,Qe):Te(this,Qe,this._makeUserProxy(Ps,"ui"))}get Utils(){return jt(this,tn)?jt(this,tn):Te(this,tn,this._makeUserProxy(Ds,"utils"))}get Git(){return this._makeUserProxy(Ms,"git")}get Assets(){return this._makeUserProxy(Ls,"assets")}get FileStorage(){let t=this._mFileStorage;return t||(t=this._mFileStorage=new pr(this)),t}get Request(){let t=this._mRequest;return t||(t=this._mRequest=new yn(this)),t}get Experiments(){let t=this._mExperiments;return t||(t=this._mExperiments=new Oi(this)),t}}function so(e,t){return new Pn(e,t)}if(window.__LSP__HOST__==null){const e=new Ti(null);window.logseq=so({},e)}})(),Y})())}(De,De.exports),De.exports;let ee="list";const Po="00000002-3698-7117-0000-000000000000",Vn="00000002-1282-1814-5700-000000000000",Le={birthday:"birthday-GB6GsLcK",lastContact:"last-contact-zKo0vxkv",contactFrequency:"contact-frequency-rE_86ouV",relationship:"relationship-F2JPblxy",email:"email-EYPFhTdc",phone:"phone-jPxSkIoq"};function Dt(c){if(!c)return null;if(typeof c=="number")return new Date(c);if(typeof c=="string"){const m=new Date(c);if(!isNaN(m.getTime()))return m;const b=c.match(/(\d{4})-(\d{2})-(\d{2})/);if(b)return new Date(parseInt(b[1]),parseInt(b[2])-1,parseInt(b[3]))}if(c instanceof Date)return c;if(typeof c=="object"&&c!==null){if(c.journal)return Dt(c.journal);if(c.date)return Dt(c.date)}return null}function Do(c){const m=new Date;m.setHours(0,0,0,0);const b=new Date(m.getFullYear(),c.getMonth(),c.getDate());b<m&&b.setFullYear(m.getFullYear()+1);const p=b.getTime()-m.getTime();return Math.ceil(p/(1e3*60*60*24))}function Lo(c){const m=new Date;m.setHours(0,0,0,0);const b=new Date(c);b.setHours(0,0,0,0);const p=m.getTime()-b.getTime();return Math.floor(p/(1e3*60*60*24))}function Kn(c){const m=new Date;let b=m.getFullYear()-c.getFullYear();const p=m.getMonth()-c.getMonth();return(p<0||p===0&&m.getDate()<c.getDate())&&b--,b}function Fo(c){return c.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function No(c){const m=new Date;m.setHours(0,0,0,0);const b=new Date(m.getFullYear(),c.getMonth(),c.getDate());return b<=m&&b.setFullYear(m.getFullYear()+1),b}function un(c){const m=c.getFullYear(),b=String(c.getMonth()+1).padStart(2,"0"),p=String(c.getDate()).padStart(2,"0");return`${m}-${b}-${p}`}function Xn(c){if(!c||c.trim()==="")return null;const m=c.trim(),b={jan:0,january:0,feb:1,february:1,mar:2,march:2,apr:3,april:3,may:4,jun:5,june:5,jul:6,july:6,aug:7,august:7,sep:8,sept:8,september:8,oct:9,october:9,nov:10,november:10,dec:11,december:11},p=m.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);if(p){const[,C,M,F]=p;return new Date(parseInt(C),parseInt(M)-1,parseInt(F))}const T=m.match(/^(\d{1,2})[\/\-\.](\d{1,2})[\/\-\.](\d{4})$/);if(T){const[,C,M,F]=T;return new Date(parseInt(F),parseInt(M)-1,parseInt(C))}const Y=m.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})$/);if(Y){const[,C,M,F]=Y,g=parseInt(C),l=parseInt(M);return g>12?new Date(parseInt(F),l-1,g):l>12?new Date(parseInt(F),g-1,l):new Date(parseInt(F),l-1,g)}const I=m.match(/^(\d{1,2})\s+([a-zA-Z]+)\s+(\d{4})$/);if(I){const[,C,M,F]=I,g=b[M.toLowerCase()];if(g!==void 0)return new Date(parseInt(F),g,parseInt(C))}const h=m.match(/^([a-zA-Z]+)\s+(\d{1,2}),?\s+(\d{4})$/);if(h){const[,C,M,F]=h,g=b[C.toLowerCase()];if(g!==void 0)return new Date(parseInt(F),g,parseInt(M))}const x=m.match(/^(\d{4})\s+([a-zA-Z]+)\s+(\d{1,2})$/);if(x){const[,C,M,F]=x,g=b[M.toLowerCase()];if(g!==void 0)return new Date(parseInt(C),g,parseInt(F))}const O=new Date(m);return isNaN(O.getTime())?null:O}function Ro(c){const m={weekday:"short",day:"numeric",month:"long",year:"numeric"};return c.toLocaleDateString("en-US",m)}function ne(c,m){if(!c)return;if(c[m]!==void 0)return c[m];const b=new RegExp(`^:user\\.property/${m}(-[A-Za-z0-9_-]+)?$`);for(const Y of Object.keys(c))if(b.test(Y))return c[Y];const p=new RegExp(`^:plugin\\.property\\.[^/]+/${m}(-[A-Za-z0-9_-]+)?$`);for(const Y of Object.keys(c))if(p.test(Y))return c[Y];const T=new RegExp(`^${m}-[A-Za-z0-9_-]+$`);for(const Y of Object.keys(c))if(T.test(Y))return c[Y]}function Ut(c){const m=String(c),b=parseInt(m.substring(0,4)),p=parseInt(m.substring(4,6))-1,T=parseInt(m.substring(6,8));return new Date(b,p,T)}async function Qn(){const c=[];try{const b=await logseq.DB.datascriptQuery(`
      [:find (pull ?p [*])
       :where
       [?t :block/title "people"]
       [?p :block/tags ?t]]
    `);if(!b||!Array.isArray(b))return console.log("People Manager: No people found or invalid result"),[];console.log("People Manager: Found",b.length,"people");for(const[p]of b){if(!p)continue;console.log("People Manager: Processing",p.name,"with keys:",Object.keys(p));const T=ne(p,"birthday"),Y=ne(p,"last-contact"),I=ne(p,"contact-frequency"),h=ne(p,"relationship"),x=ne(p,"email");console.log("People Manager: Raw birthday value:",T,"type:",typeof T);let O=null,C=null;if(T)if(typeof T=="object"&&T.id){console.log("People Manager: Birthday is a reference with id:",T.id);try{const l=await logseq.Editor.getBlock(T.id);console.log("People Manager: Resolved date entity:",l),l&&(l.journalDay?O=Ut(l.journalDay):l["journal-day"]?O=Ut(l["journal-day"]):l[":block/journal-day"]?O=Ut(l[":block/journal-day"]):l.title?O=Dt(l.title):l.name&&(O=Dt(l.name)),console.log("People Manager: Resolved birthday date:",O))}catch(l){console.log("People Manager: Error resolving birthday reference:",l)}}else typeof T=="string"?O=Dt(T):typeof T=="number"&&(O=Ut(T));if(Y)if(typeof Y=="object"&&Y.id){const l=await logseq.Editor.getBlock(Y.id);l&&(l.journalDay?C=Ut(l.journalDay):l["journal-day"]?C=Ut(l["journal-day"]):C=Dt(l.name||l.title))}else C=Dt(Y);let M=null;if(I)if(typeof I=="number")M=I;else if(typeof I=="object"&&I.id){const l=await logseq.Editor.getBlock(I.id);if(l){const E=l[":logseq.property/value"];E!==void 0?M=typeof E=="number"?E:parseInt(String(E)):M=parseInt(l.title||l.content||"0"),console.log("People Manager: Resolved contact-frequency",l,"->",M)}}else M=parseInt(String(I));let F=null;if(h){if(typeof h=="string")F=h;else if(typeof h=="object"&&h.id){const l=await logseq.Editor.getBlock(h.id);l&&(F=l.title||l.content||null,console.log("People Manager: Resolved relationship",l,"->",F))}}const g={uuid:p.uuid,name:p["original-name"]||p.name||"Unknown",birthday:O,lastContact:C,contactFrequency:M,relationship:F,email:typeof x=="string"?x:null};console.log("People Manager: Parsed person",g),c.push(g)}}catch(m){console.error("People Manager: Error querying people:",m)}return c}function tr(c,m=30){const b=[];for(const p of c){if(!p.birthday)continue;const T=Do(p.birthday);T<=m&&b.push({person:p,daysUntil:T,age:T===0?Kn(p.birthday):Kn(p.birthday)+1})}return b.sort((p,T)=>p.daysUntil-T.daysUntil)}function er(c){const m=[];for(const b of c){if(!b.contactFrequency)continue;const p=b.lastContact?Lo(b.lastContact):1/0,T=p-b.contactFrequency;(T>=0||!b.lastContact)&&m.push({person:b,daysSinceContact:p===1/0?-1:p,daysOverdue:b.lastContact?T:b.contactFrequency})}return m.sort((b,p)=>p.daysOverdue-b.daysOverdue)}async function Uo(c,m){try{const b=await logseq.Editor.getCurrentPage();if(!b)return console.error("People Manager: No current page for birthday task"),!1;const p=m===0?`TODO [[${c.name}]]'s Birthday is TODAY!`:`TODO [[${c.name}]]'s Birthday in ${m} days`;return await logseq.Editor.insertBlock(b.uuid,p,{sibling:!1}),!0}catch(b){return console.error("People Manager: Error creating birthday task:",b),!1}}async function $o(c,m){try{const b=await logseq.Editor.getCurrentPage();if(!b)return console.error("People Manager: No current page for contact task"),!1;const p=m>0?`TODO Reach out to [[${c.name}]] (${m} days overdue)`:`TODO Time to contact [[${c.name}]]`;return await logseq.Editor.insertBlock(b.uuid,p,{sibling:!1}),!0}catch(b){return console.error("People Manager: Error creating contact task:",b),!1}}async function qo(c){try{if(!c.name||c.name.trim()==="")return{success:!1,error:"Name is required"};const m=c.name.trim();if(await logseq.Editor.getPage(m))return{success:!1,error:`A page named "${m}" already exists`};const p=await logseq.Editor.createPage(m,{},{createFirstBlock:!1,redirect:!1});if(!p)return{success:!1,error:"Failed to create page"};if(console.log("People Manager: Created page",p),await logseq.Editor.addBlockTag(p.uuid,Po),c.birthday&&await logseq.Editor.upsertBlockProperty(p.uuid,Le.birthday,c.birthday),c.relationship&&await logseq.Editor.upsertBlockProperty(p.uuid,Le.relationship,c.relationship),c.contactFrequency&&c.contactFrequency>0&&await logseq.Editor.upsertBlockProperty(p.uuid,Le.contactFrequency,c.contactFrequency),c.email&&await logseq.Editor.upsertBlockProperty(p.uuid,Le.email,c.email),c.birthday){const T=new Date(c.birthday);isNaN(T.getTime())||await zo(m,T)}return console.log("People Manager: Person created successfully:",m),{success:!0}}catch(m){return console.error("People Manager: Error creating person:",m),{success:!1,error:String(m)}}}async function zo(c,m){try{const b=No(m),p=un(b);console.log(`People Manager: Creating birthday task for ${c} on ${p}`);let T=await logseq.Editor.getPage(p);if(T||(T=await logseq.Editor.createPage(p,{},{createFirstBlock:!1,journal:!0,redirect:!1})),!T)return console.error("People Manager: Could not get or create journal page"),!1;const Y=`[[${c}]]'s Birthday!`,I=await logseq.Editor.appendBlockInPage(T.uuid,Y);return I&&(await logseq.Editor.addBlockTag(I.uuid,Vn),console.log("People Manager: Created birthday task block with #Task tag")),console.log(`People Manager: Created birthday reminder for ${c} on ${p}`),!0}catch(b){return console.error("People Manager: Error creating birthday reminder:",b),!1}}function Bo(c){return`
    ${c?`
      <div class="success-message">
        <span></span> ${c}
      </div>
    `:""}
    
    <div class="back-link" data-action="back">
       Back to list
    </div>
    
    <div class="section">
      <div class="section-title">Add New Person</div>
      
      <form id="add-person-form">
        <div class="form-group">
          <label for="person-name">Name *</label>
          <input type="text" id="person-name" placeholder="Enter person's name" required>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="person-birthday">Birthday</label>
            <input type="text" id="person-birthday" placeholder="e.g., 15 Apr 1988 or 1988-04-15">
            <div id="birthday-preview" class="input-preview"></div>
          </div>
          
          <div class="form-group">
            <label for="person-relationship">Relationship</label>
            <select id="person-relationship">
              <option value="">Select...</option>
              <option value="family">Family</option>
              <option value="friend">Friend</option>
              <option value="colleague">Colleague</option>
              <option value="mentor">Mentor</option>
              <option value="acquaintance">Acquaintance</option>
            </select>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="person-contact-freq">Contact Frequency (days)</label>
            <input type="number" id="person-contact-freq" placeholder="e.g., 14" min="1">
          </div>
          
          <div class="form-group">
            <label for="person-email">Email</label>
            <input type="email" id="person-email" placeholder="email@example.com">
          </div>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" data-action="save-and-add">
            Save & Add Another
          </button>
          <button type="submit" class="btn btn-primary">
            Save & Close
          </button>
        </div>
      </form>
    </div>
  `}function Ho(c,m){let b="";if(b+=`
    <div class="section">
      <div class="section-title">
        Upcoming Birthdays
        ${c.length>0?`<span class="badge">${c.length}</span>`:""}
      </div>
  `,c.length===0)b+='<div class="empty-state">No upcoming birthdays in the next 30 days</div>';else for(const p of c){const T=p.daysUntil===0?"Today!":p.daysUntil===1?"Tomorrow":`${p.daysUntil} days`,Y=p.daysUntil<=7?"soon":"ok";b+=`
        <div class="person-card" data-uuid="${p.person.uuid}" data-action="open">
          <div class="person-info">
            <div class="person-name">${p.person.name}</div>
            <div class="person-detail">
              ${p.person.birthday?Fo(p.person.birthday):""} 
              ${p.age?`(turning ${p.age})`:""}
            </div>
          </div>
          <div class="person-action">
            <span class="days-badge ${Y}">${T}</span>
          </div>
        </div>
      `}if(b+="</div>",b+=`
    <div class="section">
      <div class="section-title">
        People to Contact
        ${m.length>0?`<span class="badge warning">${m.length}</span>`:""}
      </div>
  `,m.length===0)b+='<div class="empty-state">All caught up! No overdue contacts.</div>';else for(const p of m){const T=p.daysOverdue>14?"overdue":"soon",Y=p.daysSinceContact<0?"Never contacted":`${p.daysOverdue}d overdue`;b+=`
        <div class="person-card" data-uuid="${p.person.uuid}" data-action="open">
          <div class="person-info">
            <div class="person-name">${p.person.name}</div>
            <div class="person-detail">
              ${p.person.relationship||"Contact"} 
              ${p.daysSinceContact>=0?`- Last: ${p.daysSinceContact}d ago`:""}
            </div>
          </div>
          <div class="person-action">
            <span class="days-badge ${T}">${Y}</span>
          </div>
        </div>
      `}return b+="</div>",b}async function $t(c){const m=document.getElementById("content");if(m){if(ee==="add"){m.innerHTML=Bo(c),Yo();return}m.innerHTML=`
    <div class="loading">
      <div class="spinner"></div>
      <div>Loading people...</div>
    </div>
  `;try{const b=await Qn(),p=tr(b,30),T=er(b);m.innerHTML=Ho(p,T),m.querySelectorAll(".person-card[data-uuid]").forEach(Y=>{Y.addEventListener("click",async()=>{const I=Y.getAttribute("data-uuid");I&&(await logseq.App.pushState("page",{name:I}),re())})})}catch(b){console.error("People Manager: Error refreshing UI:",b),m.innerHTML=`
      <div class="empty-state">
        Error loading people. Check console for details.
      </div>
    `}}}function Wo(){const c=document.getElementById("person-name"),m=document.getElementById("person-birthday"),b=document.getElementById("person-relationship"),p=document.getElementById("person-contact-freq"),T=document.getElementById("person-email");let Y=null;if(m?.value){const I=Xn(m.value);I&&(Y=un(I))}return{name:c?.value||"",birthday:Y,relationship:b?.value||null,contactFrequency:p?.value?parseInt(p.value):null,email:T?.value||null}}function Go(){const c=document.getElementById("add-person-form");c&&c.reset()}function Yo(){const c=document.getElementById("content");if(!c)return;const m=c.querySelector('[data-action="back"]');m&&m.addEventListener("click",()=>{ee="list",$t()});const b=document.getElementById("person-birthday"),p=document.getElementById("birthday-preview");b&&p&&b.addEventListener("input",()=>{const I=b.value.trim();if(!I){p.textContent="",p.className="input-preview";return}const h=Xn(I);h?(p.textContent=Ro(h),p.className="input-preview valid"):(p.textContent="Could not parse date",p.className="input-preview invalid")});const T=document.getElementById("add-person-form");T&&T.addEventListener("submit",async I=>{I.preventDefault(),await nr(!1)});const Y=c.querySelector('[data-action="save-and-add"]');Y&&Y.addEventListener("click",async()=>{await nr(!0)})}async function nr(c){const m=Wo();if(!m.name||m.name.trim()===""){await logseq.UI.showMsg("Please enter a name","warning");return}const b=await qo(m);if(b.success)if(c){Go(),await $t(`Added "${m.name}" successfully!`);const p=document.getElementById("person-name");p&&p.focus()}else ee="list",await logseq.UI.showMsg(`Added "${m.name}" successfully!`,"success"),await $t();else await logseq.UI.showMsg(b.error||"Failed to create person","error")}function rr(){ee="add",$t()}async function dn(){const c=await Qn(),m=tr(c,7),b=er(c);let p=0;for(const T of m)await Uo(T.person,T.daysUntil)&&p++;for(const T of b)T.daysOverdue>=0&&await $o(T.person,T.daysOverdue)&&p++;p>0?await logseq.UI.showMsg(`Created ${p} reminder task(s)`,"success"):await logseq.UI.showMsg("No new reminders needed","info"),re()}function or(){ee="list",logseq.showMainUI({autoFocus:!0}),$t()}function re(){logseq.hideMainUI({restoreEditingCursor:!0})}function Jo(){logseq.isMainUIVisible?re():or()}function Zo(c){const m=c.match(/\[\[([^\]]+)\]\]['']s Birthday/);return m?m[1]:null}function Vo(c){return c.includes("'s Birthday")&&c.includes("[[")}async function Ko(c){try{console.log(`People Manager: Birthday task completed for ${c}, creating next year's reminder`);const m=await logseq.Editor.getPage(c);if(!m){console.log(`People Manager: Could not find page for ${c}`);return}const b=ne(m,"birthday");if(!b){console.log(`People Manager: No birthday found for ${c}`);return}let p=null;if(typeof b=="object"&&b.id){const x=await logseq.Editor.getBlock(b.id);x&&(x.journalDay?p=Ut(x.journalDay):x["journal-day"]?p=Ut(x["journal-day"]):p=Dt(x.name||x.title))}else p=Dt(b);if(!p){console.log(`People Manager: Could not parse birthday date for ${c}`);return}const T=new Date;T.setHours(0,0,0,0);const Y=new Date(T.getFullYear()+1,p.getMonth(),p.getDate()),I=un(Y);let h=await logseq.Editor.getPage(I);if(h||(h=await logseq.Editor.createPage(I,{},{createFirstBlock:!1,journal:!0,redirect:!1})),h){const x=`[[${c}]]'s Birthday!`,O=await logseq.Editor.appendBlockInPage(h.uuid,x);O&&await logseq.Editor.addBlockTag(O.uuid,Vn)}console.log(`People Manager: Created birthday reminder for ${c} on ${I}`),await logseq.UI.showMsg(`Created next year's birthday reminder for ${c}`,"success")}catch(m){console.error("People Manager: Error handling birthday task completion:",m)}}function Xo(){logseq.DB.onChanged(async({blocks:c,txData:m,txMeta:b})=>{if(!(!c||c.length===0))for(const p of c){const T=p.content||"";if(Vo(T)&&T.startsWith("DONE")){const Y=Zo(T);Y&&setTimeout(()=>{Ko(Y)},500)}}}),console.log("People Manager: Task completion listener set up")}async function Qo(){console.log("People Manager plugin loaded"),logseq.provideModel({toggleUI:Jo,closeUI:re,refresh:$t,checkAll:dn,addPerson:rr}),logseq.App.registerUIItem("toolbar",{key:"people-manager-button",template:`
      <a class="button" data-on-click="toggleUI" title="People Manager" style="display: flex; align-items: center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
      </a>
    `}),logseq.Editor.registerSlashCommand("People Manager",async()=>{or()}),logseq.Editor.registerSlashCommand("Add Person",async()=>{ee="add",logseq.showMainUI({autoFocus:!0}),$t()}),logseq.Editor.registerSlashCommand("Check Birthday Reminders",async()=>{await dn()}),document.addEventListener("keydown",c=>{c.key==="Escape"&&re()}),document.addEventListener("click",c=>{c.target?.closest("[data-close]")&&re()}),document.addEventListener("click",c=>{const b=c.target?.closest("button[data-on-click]");if(b)switch(b.getAttribute("data-on-click")){case"refresh":$t();break;case"addPerson":rr();break;case"checkAll":dn();break}}),Xo(),console.log("People Manager: Ready")}logseq.ready(Qo).catch(console.error)})();
